define(["require","api","common","blocks/stationSelector"],function(e,t,n,r){var i=null,s={extobj:{data:null,listPlugin:[],el:"#ResolveCautionTpl-dialog",events:{"click .submit-btn.sdone":"onsubmit","click .submit-btn.ignore":"onignore","click .cancel-btn":"oncancel"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"caution:resolved",function(){t.showErrTips("处理完成"),Backbone.Events.trigger("listdata:refresh","caution"),t.oncancel()}),t.listenTo(Backbone.Events,"caution:resolved:fail",function(e){t.showErrTips(e.response.message)})},setValue:function(){this.data&&n.setFormValue(this.el,this.data)},getParam:function(){return n.getFormValue(this.el,!0)},showErrTips:function(e){return alert(e),!1},validate:function(e){var t=!0;return $mastFills=$(".mast-fill",this.el),$mastFills.each(function(n,r){var i=$(r).attr("for"),s;if(typeof e[i]=="undefined"||!e[i])return s=$(r).parent().html().replace(/<i[^>]*>.*(?=<\/i>)<\/i>/gi,""),alert(s+"为必填项"),t=!1,!1}),t},onsubmit:function(){var e=this,n=e.getParam();e.validate(n)&&t.resolveCaution({id:n.id,markup:n.markup,contact:n.contact,stauts:1})},onignore:function(){var e=this,n=e.getParam();t.resolveCaution({id:n.id,markup:"",contact:"",status:2})},oncancel:function(){this.stopListening(),this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove()}}},o;return{show:function(e){var t=$("#ResolveCautionTpl-dialog").length?$("#ResolveCautionTpl-dialog").replaceWith($($("#ResolveCautionTpl").html())):$($("#ResolveCautionTpl").html());t.dialog({modal:!0,show:300,height:400,width:600,title:"警情处理",close:function(e,t){i.oncancel()},open:function(){$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(s.extobj)),i.dialogObj=$(this),console.log(e),e&&($("[key=id]",t).val(e.id),$("#suggestion",t).html(e.suggestion))}})},detroy:function(){i.oncancel()}}});