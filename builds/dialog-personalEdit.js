define(["require","api","common","blocks/areaSelector"],function(e,t,n,r){var i=null,s={extobj:{data:null,listPlugin:[],el:"#personalEditTpl-dialog",events:{"click .submit-btn":"onsubmit","click .cancel-btn":"oncancel"},initialize:function(e){var t=this;t.level=r.init(),t.listenTo(Backbone.Events,"personalInfo:get",function(e){t.data=e,this.level=r.init({value:e.area}),t.setValue()}),t.listenTo(Backbone.Events,"personal:create personal:update",function(){window.location.reload(),t.oncancel(),Backbone.Events.trigger("listdata:refresh","batteryInfo")}),t.listenTo(Backbone.Events,"personal:update:fail",function(e){alert(e.response.msg);return})},setValue:function(){this.data&&n.setFormValue(this.el,this.data)},getParam:function(){return n.getFormValue(this.el,!0)},showErrTips:function(e){return alert(e),!1},validate:function(e){return!0},onsubmit:function(){var e=this,n=e.getParam();n.area=this.level.getValue(),n.role=$("[key=role]",this.el).val(),n.canedit=$("[key=canedit]",this.el).val(),console.log(n),console.log(this.level,"level"),e.validate(n)&&(n.id?t.updatePersonalInfo(n):t.createPersonal(n))},oncancel:function(){this.stopListening(),this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove(),this.level.destroy(),this.level=null}}};return{show:function(e){var n=this,o=$("#personalEditTpl-dialog").length?$("#personalEditTpl-dialog").replaceWith($($("#personalEditTpl").html())):$($("#personalEditTpl").html());try{var u=JSON.parse(localStorage.getItem("userinfo")).role}catch(a){var u=3;console.log(a)}o.dialog({modal:!0,show:300,height:500,width:1e3,title:e?"编辑人员信息":"添加人员",close:function(e,t){i.oncancel()},open:function(){$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(s.extobj)),i.dialogObj=$(this),e?t.getPersonalInfo({id:e},function(){console.log("get data")}):(n.level=n.level||r.init(),console.log(n.level)),setTimeout(function(){},1e3)}})},detroy:function(){i.oncancel()}}});