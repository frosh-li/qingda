define(["require","backbone","context","ui","common","stationsinfoDialog","api","stationsinfoDialog","map","blocks/list","blocks/nav","blocks/charts","blocks/listSearch","blocks/list","blocks/nav"],function(e,t,n,r,i,s,o){function l(n,u,a,f){var l=$(".stationPop");$("body").stopTime("irc"),l.off("click").on("click",function(e){var t=navTree.getSites().ids;if(t<0){alert("请选择站点");return}for(var n=0;n<t.length;n++)t[n]=t[n]+"0000";s.show(t.join(","))}),$(".exportdata").hide();var p=JSON.parse(localStorage.getItem("userinfo")).role,d=JSON.parse(localStorage.getItem("userinfo")).canedit,m=JSON.parse(localStorage.getItem("userinfo")).area;p==2&&d!=1&&($(".list-edit-btn").hide(),$(".list-del-btn").hide(),$("#listBtns li.undis").hide()),p!=1?$(".manage.newstations").hide():n=="manage"?$(".manage.newstations").show():$(".manage.newstations").hide(),p==3&&$(".switch-btn.settings").hide(),p==2&&($("#addBMS").hide(),$("#addCompany").hide(),$("#addBattery").hide(),$("#addUps").hide(),$(".settings.message").hide()),p==2&&m!="*"&&$(".optionSetting.otherOption").hide(),t.listenTo(t.Events,"stat",function(e){$("#stat_login_time").html(e.loginTime),$("#stat_sys_uptime").html(e.startTime),$("#stat_manager").html(e.name)}),o.stat(),$("#logout").off("click").bind("click",function(){confirm("确定要退出系统吗？")&&$.ajax({url:"/api/index.php/login/loginOut",type:"get",success:function(){localStorage.removeItem("userinfo"),window.location.href="/"}})});var g=arguments,y=$("#navTree"),b=$("#collect").hide(),w=$("#collectIRWrap").hide(),E=$("#duration").hide(),S=$(".search-jqtransform").hide();l=$(".stationPop"),$(".cj-btn").click(function(){}),$stationPopDialog=null,e(["dialogstationsinfo"],function(e){$stationPopDialog=e.init()}),$("#dataItem").html("");if("map"==n){e(["map"],function(e){r.resize(),e.init()});return}setTimeout(function(){var e=["#/manage/station","#/manage/group","#/manage/battery","#/manage/caution","#/manage/systemAlarm"],t=parseInt($("#collectDuration").val()),n=window.location.hash;e.indexOf(n)>-1||n.indexOf("manage/station")>-1?t&&localStorage.getItem("collecting")=="true"?($("body").addClass("collecting").everyTime(t+"s","collect",o.collect),$("#startCollectBtn").hide(),$(".tzcj").css("display","block")):($("body").removeClass("collecting").stopTime("collect",o.collect),$("#startCollectBtn").css("display","block"),$(".tzcj").hide()):($("body").removeClass("collecting").stopTime("collect",o.collect),$("#startCollectBtn").css("display","none"),$(".tzcj").hide())},1e3),i.loadTips.show("系统加载中，请稍后..."),/^caution$/.test(u)&&($("#dataItem").html($("#listTpl").html()),r.downHide(!0),$(".atype").show(),$(".stationPop").show(),b.show(),u=="battery"?$(".list-bottom.undis").show():$(".list-bottom.upage").show(),r.switchChartBtns(u),e(["blocks/list","blocks/nav","api"],function(e,t,r){v(n,u,a),navTree?h([e],g):(h([t],g),t.run(function(){navTree=t,h([e],g)})),r.getLinkingStationNum().getParam({},"refresh:get"),c()})),/^newstations$/.test(u)&&($("#dataItem").html($("#listTpl").html()),r.downHide(!0),b.show(),$(".stationPop").hide(),u=="battery"?$(".list-bottom.undis").show():$(".list-bottom.upage").show(),r.switchChartBtns(u),e(["blocks/list","blocks/nav","api"],function(e,t,r){v(n,u,a),navTree?h([e],g):(h([t],g),t.run(function(){navTree=t,h([e],g)})),r.getLinkingStationNum().getParam({},"refresh:get"),c()})),/^systemAlarm$/.test(u)&&($("#dataItem").html($("#listTpl").html()),r.downHide(!0),b.show(),$(".stationPop").show(),u=="battery"?$(".list-bottom.undis").show():$(".list-bottom.upage").show(),r.switchChartBtns(u),e(["blocks/list","blocks/nav","api"],function(e,t,r){v(n,u,a),navTree?h([e],g):(h([t],g),t.run(function(){navTree=t,h([e],g)})),r.getLinkingStationNum().getParam({},"refresh:get"),c()})),/^(station|group|battery)$/.test(u)?($("#dataItem").html($("#listTpl").html()),r.downShow(!0),b.show(),$(".stationPop").show(),u=="battery"?$(".list-bottom.undis").show():$(".list-bottom.upage").show(),r.switchChartBtns(u),e(["blocks/charts","blocks/list","blocks/nav","api"],function(e,t,r,i){v(n,u,a),navTree?h([t,e],g):(h([r],g),r.run(function(){navTree=r,h([t,e],g)})),i.getLinkingStationNum().getParam({},"refresh:get"),c()})):/^(IRCollect)$/.test(u)?($(".stationPop").hide(),r.downHide(!0),$("#dataItem").html($("#listTpl").html()),w.show(),e(["blocks/list","blocks/nav"],function(e,t){h([t,e],g),v(n,u,a),navTree||(t.run(),navTree=t),c()})):/^(limitation|baseinfo|equipment|option|runlog|adminConfig)$/.test(u)?(r.downHide(!0),$(".stationPop").hide(),$("#dataItem").html($("#listTpl").html()),E.show(),e(["blocks/list","blocks/nav"],function(e,t){h([t,e],g),v(n,u,a),navTree||(t.run(),navTree=t),c()})):/^(uilog)$/.test(u)?($(".stationPop").hide(),$("#dataItem").html($("#listTpl").html()),r.downHide(!0),S.show(),S.jqTransform(),$(".exportdata").hide(),$(".list-bottom.upage").show(),$(".report-caution-selector",S).parents(".jqTransformSelectWrapper").hide(),$(".reportCaution",S).hide(),e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()})):/^(qureyBattery|qureyStation|qureyGroup|qureyCaution)$/.test(u)?($("#dataItem").html($("#listTpl").html()),$(".stationPop").hide(),r.downShow(!1),S.show(),S.jqTransform(),$(".exportdata").hide(),$(".list-bottom.upage").show(),$(".report-caution-selector",S).parents(".jqTransformSelectWrapper").hide(),$(".reportCaution",S).hide(),/^qureyCaution$/.test(u)?($(".report-caution-selector",S).parents(".jqTransformSelectWrapper").show(),$(".reportCaution",S).show(),S.jqTransform(),r.downHide(!0),e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()})):e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()}),r.downShow(!1)):/^(reportUilog|chargeOrDischarge|deviationTrend|batteryLife|reportCaution)$/.test(u)?(r.downHide(!0),$(".stationPop").hide(),$(".exportdata").show(),$("#dataItem").html($("#listTpl").html()),S.show(),S.jqTransform(),u!="reportCaution"?($(".report-caution-selector",S).parents(".jqTransformSelectWrapper").hide(),$(".reportCaution",S).hide()):($(".report-caution-selector",S).parents(".jqTransformSelectWrapper").show(),$(".reportCaution",S).show()),$(".list-bottom.upage").show(),e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()})):/^(stationOption)$/.test(u)?($(".stationPop").hide(),$("#dataItem").html($("#listTpl").html()),r.downHide(!0),S.show(),S.jqTransform(),$(".exportdata").show(),$(".list-bottom.upage").show(),$(".report-caution-selector",S).parents(".jqTransformSelectWrapper").hide(),$(".reportCaution",S).hide(),e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()})):/^(manager|message|optionSetting|cautionEquipmentSetting|equipmentSetting|update|limitationSetting)$/.test(u)?(r.downHide(!0),$(".stationPop").hide(),"otherOption"==a?e(["blocks/nav","api"],function(e,t){$("#dataItem").html($("#otherOptionEditTpl-tpl").html()),h([e],g),v(n,u,a),navTree||(e.run(),navTree=e),t.getParam({},"otherOption:get"),c()}):e(["blocks/list","blocks/nav"],function(e,t){$("#dataItem").html($("#listTpl").html()),h([t,e],g),v(n,u,a),navTree||(t.run(),navTree=t),c()})):/^(stationInfo)$/.test(u)&&($(".stationPop").hide(),r.downHide(!0),a=="tree"?e(["blocks/customTree","blocks/nav"],function(e,t){h([t,e],g),v(n,u,a),navTree||(t.run(),navTree=t),c()}):e(["blocks/listSearch","blocks/list","blocks/nav"],function(e,t,r){$("#dataItem").html($("#listTpl").html()),h([r,e,t],g),v(n,u,a),navTree||(r.run(),navTree=r),c()}))}function c(){var e=!!u.length;$.each(u,function(t,n){if(!n.isOver())return e=!1,!1}),e||f>a?(i.loadTips.close(),f=0):(f+=200,$("body").oneTime("0.2s",function(){c()}))}function h(e,t){var n=[];p(),d(e,t)}function p(){$.each(u,function(e,t){t&&t.destory&&t.destory()}),u=[]}function d(e,t){var n=e.shift();n&&n.init&&(n.init.apply(n,t),u.push(n),d(e,t))}function v(e,t,n){r.resize().switchNav(e,t,n)}var u=[],a=1e3,f=0;return window.navTree=null,{init:function(e,t,n,r){return pagetype=t,l(e,t,n,r),r,s.init(),this},refresh:function(e,t,n){pagetype=t,l(e,t,n)}}});