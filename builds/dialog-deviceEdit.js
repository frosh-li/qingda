define(["require","api","common","blocks/stationSelector"],function(e,t,n,r){var i=null,s,o={extobj:{data:null,listPlugin:[],el:"#deviceEditTpl-dialog",events:{"click .submit-btn":"onsubmit","click .cancel-btn":"oncancel"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"stationdevice:get",function(e){t.data=e,t.setValue()}),t.listenTo(Backbone.Events,"stationdevice:create stationdevice:update",function(){t.oncancel(),Backbone.Events.trigger("listdata:refresh","device")})},setValue:function(){this.data&&n.setFormValue(this.el,$.extend({id:s},this.data))},getParam:function(){return n.getFormValue(this.el,!0)},showErrTips:function(e){return alert(e),!1},validate:function(e){return e.site_name?e.sid?!0:this.showErrTips("站点不存在"):this.showErrTips("站点为必填项")},onsubmit:function(){var e=this,n=e.getParam();e.validate(n)&&(n.id?t.updateStationdevice(n):t.createStationdevice(n))},oncancel:function(){this.stopListening(),this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove(),u.autocomplete("destroy"),s=""}}},u;return{show:function(e){var n=$("#deviceEditTpl-dialog").length?$("#deviceEditTpl-dialog").replaceWith($($("#deviceEditTpl").html())):$($("#deviceEditTpl").html());s=e,n.dialog({modal:!0,show:300,height:400,width:1e3,title:"编辑",close:function(e,t){i.oncancel()},open:function(){$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(o.extobj)),i.dialogObj=$(this),e&&t.getStationdevice({id:e}),u=r.init({extOption:{select:function(e,t){return $(this).val(t.item.label),$("[key=sid]").val(t.item.value),!1}}})}})},detroy:function(){i.oncancel()}}});