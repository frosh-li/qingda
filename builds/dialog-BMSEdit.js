define(["require","api","common","blocks/stationSelector"],function(e,t,n,r){var i=null,s={extobj:{data:null,listPlugin:[],el:"#BMSEditTpl-dialog",events:{"click .submit-btn":"onsubmit","click .cancel-btn":"oncancel"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"bmsInfo:get",function(e){t.data=e,t.setValue()}),t.listenTo(Backbone.Events,"bms:create bms:update",function(){t.oncancel(),window.location.reload(),Backbone.Events.trigger("listdata:refresh","batteryInfo")})},setValue:function(){this.data&&n.setFormValue(this.el,this.data)},getParam:function(){return n.getFormValue(this.el,!0)},showErrTips:function(e){return alert(e),!1},validate:function(e){var t=!0;return $mastFills=$(".mast-fill",this.el),$mastFills.each(function(n,r){var i=$(r).attr("for"),s;if(typeof e[i]=="undefined"||!e[i])return s=$(r).parent().html().replace(/<i[^>]*>.*(?=<\/i>)<\/i>/gi,""),alert(s+"为必填项"),t=!1,!1}),t},onsubmit:function(){var e=this,n=e.getParam();e.validate(n)&&(n.id?t.updateBMSInfo(n):t.createBMS(n))},oncancel:function(){this.stopListening(),this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove(),o.autocomplete("destroy")}}},o;return{show:function(e){var n=$("#BMSEditTpl-dialog").length?$("#BMSEditTpl-dialog").replaceWith($($("#BMSEditTpl").html())):$($("#BMSEditTpl").html()),u=JSON.parse(localStorage.getItem("userinfo")).role,a="";u!=1?a="disabled":a="",n.dialog({modal:!0,show:300,height:400,width:1e3,title:"编辑",close:function(e,t){i.oncancel()},open:function(){console.log("dianchi"),$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(s.extobj)),i.dialogObj=$(this),$("form.jqtransform").html($("form.jqtransform").html().replace(/{{disabled}}/g,a)),$("form.jqtransform").find("[changedisabled=disabled]").attr("disabled",!0),e&&t.getBMSInfo({id:e}),o=r.init({extOption:{select:function(e,t){return $(this).val(t.item.label),$("[key=sid]").val(t.item.value),!1}}}),$("form.jqtransform [ipttype=date]").datepicker({dateFormat:"yy-mm-dd"})}})},detroy:function(){i.oncancel()}}});