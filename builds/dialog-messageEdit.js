define(["require","api","common","blocks/levelSlector"],function(e,t,n,r){var i=null,s={extobj:{data:null,listPlugin:[],el:"#messageEditTpl-dialog",events:{"click .submit-btn":"onsubmit","click .cancel-btn":"oncancel"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"message:update",function(e){t.data=e,o=o||r.init({value:e.aid}),t.setValue()}),t.listenTo(Backbone.Events,"message:create message:update",function(){t.oncancel(),Backbone.Events.trigger("listdata:refresh","message")})},setValue:function(){this.data&&n.setFormValue(this.el,this.data)},getParam:function(){var e=n.getFormValue(this.el,!0);return e.phone_status="0",$("[key=phone_status]",this.el).siblings(".jqTransformChecked").length&&(e.phone_status="1"),e.email_status="0",$("[key=email_status]",this.el).siblings(".jqTransformChecked").length&&(e.email_status="1"),e},showErrTips:function(e){return alert(e),!1},validate:function(e){var t=!0;return $mastFills=$(".mast-fill",this.el),$mastFills.each(function(n,r){var i=$(r).attr("for"),s;if(i&&(typeof e[i]=="undefined"||!e[i]))return s=$(r).parent().html().replace(/<i[^>]*>.*(?=<\/i>)<\/i>/gi,""),alert(s+"为必填项"),t=!1,!1}),t},onsubmit:function(){var e=this,n=e.getParam();n.area=o.getValue(),e.validate(n)&&(n.id?t.updateMessage(n):t.createMessage(n))},oncancel:function(){this.stopListening(),o.destroy(),o=null,this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove()}}},o;return{show:function(e){var n=$("#messageEditTpl-dialog").length?$("#messageEditTpl-dialog").replaceWith($($("#messageEditTpl").html())):$($("#messageEditTpl").html());n.dialog({modal:!0,show:300,height:420,width:600,title:e?"编辑短信/邮箱":"添加短信/邮箱",close:function(e,t){i.oncancel()},open:function(){$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(s.extobj)),i.dialogObj=$(this),e?t.getMessageInfo({id:e}):o=r.init(),$("form.jqtransform [key=bms_install_date]").datepicker({dateFormat:"yy-mm-dd"})}})},detroy:function(){i.oncancel()}}});