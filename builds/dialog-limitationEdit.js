define(["require","api","context","common","table"],function(e,t,n,r){var i=null,s="1",o,u={"default":{extobj:{data:null,listPlugin:[],el:"#limitationEditTpl-dialog",events:{"click .switch-btn":"onChangeCatagory","click .open-limitation-btn":"onOpen","click .close-limitation-btn":"onClose","click .save-limitation-btn":"onSave"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"alarmOptions:get",function(e){t.data=e.list,t.render()}),t.listenTo(Backbone.Events,"limit:open",function(e){alert("开启成功")}),t.listenTo(Backbone.Events,"limit:close",function(e){alert("关闭成功")}),t.listenTo(Backbone.Events,"alarmOptions:update",function(e){alert("保存成功")})},onChangeCatagory:function(e){var n=$(e.currentTarget),r=n.attr("t");s=r,this.clearTables(),t.getAlarmOptions({sid:o,category:s})},onOpen:function(e){t.openLimit({id:$(e.currentTarget).attr("pid")})},onClose:function(e){t.closeLimit({id:$(e.currentTarget).attr("pid")})},onSave:function(e){var n=$(e.currentTarget),i=n.attr("pid"),s=$(this.el).find("."+i).parents("tr").eq(0),o=r.getFormValue(s,!0);t.updateLimit(o)},refresh:function(){var e=this,t=e.getParam();t&&e.fetchData(t)},clearTables:function(){$.fn.dataTable.isDataTable("#limitationEditTpl-dialog table")&&(this.listPlugin.clear(),this.listPlugin.destroy())},getParam:function(){var e=n.getCurStations(),t=n.getListType();return{listType:t}},oncancel:function(){this.clearTables(),this.stopListening(),this.dialogObj&&this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove()},render:function(){var t=this;return e(["fixedColumn"],function(){t.listPlugin=$("#limitationEditTpl-dialog table").DataTable({data:t.data,paging:!1,searching:!1,info:!1,scrollX:!0,scrollY:570,rowId:"staffId",fixedColumns:{rightColumns:1},fnDrawCallback:function(e){if(e.bSorted||e.bFiltered)for(var t=0,n=e.aiDisplay.length;t<n;t++)$("td:eq(0)",e.aoData[e.aiDisplay[t]].nTr).html('<label class="index">'+(t+1)+"</label>")},columns:[{data:"id",title:"序号",width:50},{data:"content",title:"警情描述",width:200},{data:"alarm_type",title:"警情级别",width:100,render:function(e,t,n){var r='<option value="<%= id %>" <%= selected %>><%= name %></option>',i=[{id:"1",name:"红色"},{id:"2",name:"橙色"},{id:"3",name:"黄色"}],s;return $.each(i,function(t,n){n.id==e?n.selected="selected":n.selected="",s+=_.template(r)(n)}),'<select class="'+n.id+'" key="alarm_type">'+s+"</select>"}},{data:"suggest",title:"警情处理建议",width:200,render:function(e,t,n){return'<input type="text" class="'+n.id+'" key="suggest" value="'+e+'"/><input type="hidden" key="id" value="'+n.id+'"><input type="hidden" key="sid" value="'+n.sid+'">'}},{data:"send_email",title:"是否发邮件",width:200,render:function(e,t,n){return _.template('<label><input type="checkbox"" name="email" key="send_email" specify-value="1|0" <%= checked %>/>发邮件</label>')({checked:e=="1"?"checked":""})}},{data:"send_msg",title:"是否发短信",width:200,render:function(e,t,n){return _.template('<label><input type="checkbox" name="email" key="send_msg" specify-value="1|0" <%= checked %>/>发短信</label>')({checked:e=="1"?"checked":""})}},{data:"operator",title:"字段名称",width:200,render:function(e,t,n){return'<input type="text" key="operator" value="'+e+'"/>'}},{data:"type_value",title:"警情判断依据",width:200,render:function(e,t,n){return'<input type="text" key="type_value" value="'+e+'"/>'}},{data:"alarm_code",title:"警情代码",width:200},{data:"id",render:function(e){var t='<div style="width:150px;"><span class="limitation-btns open-limitation-btn" pid="<%= id %>">开启</span>|<span pid="<%= id %>" class="limitation-btns close-limitation-btn">关闭</span>|<span pid="<%= id %>" class="limitation-btns save-limitation-btn">保存</span></div>',n=JSON.parse(localStorage.getItem("userinfo")).role;return n==1?_.template(t)({id:e}):""}}]}),$("#stationinfoTpl-dialog .dataTables_scrollBody").height(270)}),this}}}};return{init:function(){return this},show:function(e){var n=$("#limitationEditTpl-dialog").length?$("#limitationEditTpl-dialog").replaceWith($($("#limitationEditTpl").html())):$($("#limitationEditTpl").html());o=e;var r=n.dialog({modal:!0,show:300,height:700,width:1e3,title:"门限修改",close:function(e,t){i.oncancel()},open:function(){i=new(Backbone.View.extend(u.default.extobj)),i.dialogObj=r,t.getAlarmOptions({sid:o,category:s})}})}}});