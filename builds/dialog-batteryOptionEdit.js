define(["require","api","common","blocks/stationSelector"],function(e,t,n,r){var i=null,s={extobj:{data:null,listPlugin:[],el:"#baterryOptionEditTpl-dialog",events:{"click .submit-btn":"onsubmit","click .cancel-btn":"oncancel"},initialize:function(e){var n=this;n.listenTo(Backbone.Events,"batteryoption:get",function(e){n.data=e,n.setValue()}),n.listenTo(Backbone.Events,"batteryoption:update",function(){n.showErrTips("修改完成，请等待5到10秒后刷新查看"),n.oncancel(),t.getBatteryOptionsData(),Backbone.Events.trigger("listdata:refresh","batteryOption")}),n.listenTo(Backbone.Events,"batteryoption:update:fail",function(e){n.showErrTips(e)})},setValue:function(){this.data&&n.setFormValue(this.el,this.data)},getParam:function(){return n.getFormValue(this.el,!0)},showErrTips:function(e){return alert(e),!1},validate:function(e){return!0},onsubmit:function(){var e=this,n=e.getParam();e.validate(n)&&n.sn_key&&(t.updateBatteryOption(n),t.syncHard(n,"BatteryPar"))},oncancel:function(){this.stopListening(),this.dialogObj.dialog("destroy"),$(".ui-dialog,.ui-widget-overlay").remove(),o.autocomplete("destroy")}}},o;return{show:function(e){var n=$("#baterryOptionEditTpl-dialog").length?$("#baterryOptionEditTpl-dialog").replaceWith($($("#baterryOptionEditTpl").html())):$($("#baterryOptionEditTpl").html());n.dialog({modal:!0,show:300,height:660,width:1e3,title:"编辑参数",close:function(e,t){i.oncancel()},open:function(){$("form.jqtransform").jqTransform(),i=new(Backbone.View.extend(s.extobj)),i.dialogObj=$(this),e&&t.getBatteryOption({sn_key:e}),o=r.init({extOption:{select:function(e,t){return $(this).val(t.item.label),$("[key=sid]").val(t.item.value),!1}}}),$("form.jqtransform [ipttype=date]").datepicker({dateFormat:"yy-mm-dd"})}})},detroy:function(){i.oncancel()}}});