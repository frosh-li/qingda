define(["require","api","ui","backbone"],function(e,t,n,r){var i,s=!1,o,u,a,f,l="",c,h="bar",p={0:"green",1:"#f76363",2:"#ff975e",3:"#ffee2c"},d={0:"image://images/chart-normal.png",1:"image://images/chart-caution.png",2:"image://images/chart-alert.png",3:"image://images/chart-notice.png"},v={data:null,navPlugin:null,el:$(".chart-wrap"),chart:null,chartOption:{},chartType:"line",origindata:null,chartName:"",initialize:function(e){var t=this;t.listenTo(r.Events,"listdata:update stationdata:get listdata:update:fail listdata:get listdata:get:fail",function(e){t.updateChart(e)}),t.listenTo(r.Events,"curstation:change",function(e){if(typeof navData=="undefined"||!navData||!navData.ids.length||!e)t.origindata={},t.origindata.list=[],t.updateChart()})},clear:function(){},getLevel:function(e,t){},updateChart:function(t){var n=this;n.origindata=t||n.origindata;var r=n.getFieldValue(),i="station",u=window.location.hash,a=[],f=[];n.origindata.list||(n.origindata.list=[]);for(var l=0;l<n.origindata.list.length;l++){var c=n.origindata.list[l];u.indexOf("station")>-1||u.indexOf("queryStation")>-1?f.push(c.site_name+"-"+c.sid):u.indexOf("group")>-1||u.indexOf("queryGroup")>-1?f.push(c.site_name+"-"+c.sid+"\n"+"组"+c.gid):(u.indexOf("battery")>-1||u.indexOf("queryBattery")>-1)&&f.push(c.site_name+"-"+c.sid+"\n"+"组"+c.gid+"-"+c.bid);var v=c[r.substring(0,3)+"Col"]||0;if(r=="Dev_R"||r=="Dev_T"||r=="Dev_U")v=c[r.replace("_","")+"Col"];a.push({value:c[r],symbol:d[v],symbolSize:14,lineStyle:{normal:{color:"yellow",width:2}},smooth:!0,itemStyle:{normal:{color:p[v]}}})}a?e(["charts"],function(e){o=e,n.createOption(h,a,f).render(),s=!0}):e(["charts"],function(e){o=e,n.createOption(h,a,f).render(),s=!0})},onChageField:function(e){s=!1,e&&(this.currentFieldElement=e),this.updateChart()},getFieldValue:function(e){return this.currentFieldElement||(this.currentFieldElement=$($(".chart-wrap .switch-btn:visible")[0])),e&&(this.currentFieldElement=e),$(".chart-wrap h4").text(this.currentFieldElement.text()),this.chartName=this.currentFieldElement.text(),$(".chart-wrap .switch-btn").removeClass("active"),$(this.currentFieldElement).addClass("active"),this.currentFieldElement.attr("field")},createOption:function(e,t,n){var r=this,i=[],s=[{type:"category",data:n?n:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]}],o=[{type:"value"}],u={},a={normal:"green",notice:"#ffee2c",alert:"#ff975e",caution:"#f86464"},f={symbolSize:8,color:"green"},l={symbolSize:8},c=[];return c.push($.extend(!0,l,{type:e,data:t,barMaxWidth:40})),r.chartOption={series:[{name:r.chartName,type:e,data:t,barMaxWidth:30,symbolSize:8,lineStyle:{normal:{color:"#000"}},smooth:!0}],xAxis:s,yAxis:o,grid:u,tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}<br/>当前值:{c}"},toolbox:{show:!0}},this},switchChartType:function(e){return h=h=="line"?"bar":"line",this},render:function(){n.resizeChartBox(),this.chart||(this.chart=o.init($("#chart")[0])),this.chart.setOption(this.chartOption)}};return $(window).resize(function(){i&&i.chart&&i.chart.resize()}),{init:function(e,t,n){return u=e,a=t,f=f,l="",$(".down").show(),i=new(r.View.extend(v)),$(".chart-wrap").off("click"),$(".chart-wrap").on("click",".switch-btn",function(e){if($(this).hasClass("disabled")){e.preventDefault();return}i.onChageField($(this))}),$(".chart-wrap").on("click",".shift-btn",function(){i.switchChartType($(this)),i.onChageField()}),this},isOver:function(e){return!0},destory:function(){i.stopListening(),$(".down").hide()}}});