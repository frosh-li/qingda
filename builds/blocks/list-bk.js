define(["require","api","stationsinfoDialog","context","ui","table"],function(e,t,n,r,i){function a(t){var n=t||"default",r=(n=="station"?"default":n)+"ListTpl";$("#list").html($("#"+r).html()),e(["blocks/block-"+t],function(e){s?s=$.extend(!0,s,$.extend(!0,{},e.getExtObj(o))):(u.default.el=$("#list"),s=new(Backbone.View.extend($.extend(!0,e.getExtObj(o),u.default.extobj))))})}var s=null,o={paging:!1,searching:!1,order:[1,"asc"],info:!1,iDisplayLength:2},u={"default":{extobj:{data:null,listPlugin:[],el:"#list",events:{"click .dataTable tr":"selectRow","click .show-info":"openStationInfoDialog","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"outRow"},initialize:function(e){var t=this;t.listenTo(Backbone.Events,"listdata:update stationdata:get",function(e){t.data=e,console.log("listdata:update stationdata:get"),t.render().resetScrollBar()}),t.listenTo(Backbone.Events,"pageType:change",function(e){a(e),console.log("pageType:change"),t.refresh()}),t.listenTo(Backbone.Events,"curstation:change",function(e){console.log("curstation:change"),t.refresh()})},openStationInfoDialog:function(){n.show()},inRow:function(e){var t=this,n=t.getRowData(e.currentTarget);$.each(t.listPlugin,function(e,t){$(t.rows().nodes()).removeClass("highlight"),$(t.rows().nodes()[n.index]).addClass("highlight")})},outRow:function(e){var t=this,n=t.getRowData(e.currentTarget);$.each(t.listPlugin,function(e,t){$(t.rows().nodes()[n.index]).removeClass("highlight")})},triggerSelectEvent:function(){var e=this,t=e.listPlugin[0].rows(".selected").data(),n=[];$.each(t,function(e,t){n.push(t.id)}),Backbone.Events.trigger("row:select",n)},selectRow:function(e){var t=this,n=t.getRowData(e.currentTarget);$.each(t.listPlugin,function(e,t){$(t.rows().nodes()[n.index]).toggleClass("selected")}),t.triggerSelectEvent()},getRowData:function(e){var t={};return $.each(this.listPlugin,function(n,r){t.data=r.row(e).data();if(t.data)return t.index=r.row(e).index(),!1}),t},resetScrollBar:function(){$("#auto .dataTables_scrollBody,#auto .dataTables_scrollHead,#auto .dataTables_scroll,#auto .dataTables_wrapper").width($("#auto .dataTable").width()),$("#auto").mCustomScrollbar({scrollButtons:{enable:!0},theme:"light-thick",scrollbarPosition:"outside",axis:"x",autoExpandScrollbar:!0,advanced:{autoExpandHorizontalScroll:!0}}),i.resizePage(),$("#xScrollBar").empty().append($("#auto .mCSB_scrollTools"))},refresh:function(){var e=this,t=e.getParam();t&&e.fetchData(t)},fetchData:function(e){t.getStationsData(e)},getParam:function(){var e=r.getCurStations(),t=r.getListType();return{listType:t}},getColumnDefs:function(){return[{targets:0,render:function(e,t,n){return'<label class="show-info">'+e+"</label>"}}]},changeListBottom:function(e){},render:function(){return this.listPlugin=[],this.listPlugin.push($("#lock table").DataTable($.extend(!0,{data:this.data,columnDefs:this.getColumnDefs(),columns:[{data:"name"},{data:"id"},{data:"time"}]},o))),i.resizeAutoListWidth(),this.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:this.data,columnDefs:this.getColumnDefs(),scrollX:!0,columns:[{data:"a"},{data:"v"},{data:"temperature"},{data:"temperature_max"},{data:"temperature_min"},{data:"humidity"},{data:"humidity_max"},{data:"group_num"},{data:"battery_num"},{data:"battery_state"},{data:"reserve_time"}]},o))),this}}}};return{init:function(e){return a(e),n.init(),this}}});