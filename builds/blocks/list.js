define(["require","api","blocks/nav","stationsinfoDialog","context","ui","common","table","fixedHeader"],function(e,t,n,r,i,s,o){function v(e,t,n){u&&(u.destroy(),u=null);var r=e?e+(t?"_"+t:""):"defaultConfig",i="defaultListTpl",s=d[r]?d[r].extObj:{};s=$.extend({},d.defaultConfig.extObj,s),$("#list").html($("#"+i).html()),u=new(Backbone.View.extend($.extend({},{el:$("#list"),ids:n},s))),h=!1;var o=["qureyGroup","qureyStation","qureyBattery","reportCaution","deviationTrend","chargeOrDischarge","batteryLife","reportUilog","uilog"];console.log("listType",e),o.indexOf(e)>-1?m()&&u.fetchData():u.fetchData()}function m(){var e=$("#beginTime").val(),t=$("#endTime").val();return e==""||t==""?!1:!0}function g(e){return e=="1"?'<label style="color:#ff0000">是</label>':'<label style="color:#888">否</label>'}function y(e){return e=="1"?"<label>是</label>":"<label>否</label>"}var u=null,a=null,f,l,c,h=!1,p={paging:!1,searching:!0,order:[],autoWidth:!0,scrollCollapse:!0,language:{lengthMenu:"显示 _MENU_ 条",paginate:{first:"首页",last:"末页",next:"下一页",previous:"上一页",info:"第 _PAGE_ 页 / 总 _PAGES_ 页"},zeroRecords:"暂无数据，请查看左侧数形结构是否已勾选或检查网络连接"},zeroRecords:"暂无数据，请查看左侧数形结构是否已勾选或检查网络连接",dom:"irtlp",scroller:{rowHeight:"auto"},fixedHeadere:{header:!0},fnDrawCallback:function(e){},info:!1},d={defaultConfig:{extObj:{data:null,el:"#list",listPlugin:[],events:{"click .dataTable tr":"selectRow","click .show-info":"openStationInfoDialog","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},initialize:function(e){var t=this;t.listPlugin=[],t.captureEvt(),t.curPage=1,t.totalpage=1},checkAllRows:function(){return;var e},captureEvt:function(){var e=this;$(".mnext").click(function(){if(e.curPage>=e.totalpage)return;e.curPage++,console.log(e.curPage),e.fetchData()}),$(".mprev").click(function(){if(e.curPage==1)return;e.curPage--,console.log(e.curPage),e.fetchData()}),e.listenTo(Backbone.Events,"listdata:update stationdata:get",function(t){console.log("listdata update",t),t.types&&(e.types=t.types);if(!$(e.el).length||!$(e.el).is(":visible"))return;var n=t.page,r=t.totals||0,i=t.pageSize||10;e.data=t.list||t||e.data,$("#totaldatas").text(r),$("#currentpage").text(e.curPage),$("#totalpage").text(Math.ceil(r/(i||10))),e.totalpage=Math.ceil(r/(i||10)),e.curPage!=1&&$(".mprev").show(),e.data.length<10||$(".mnext").show();var s=/qurey/.test(window.location.href)?1:0;e.render(s),e.renderChart(),console.log("render over"),setTimeout(function(){var e=JSON.parse(localStorage.getItem("userinfo")).role,t=JSON.parse(localStorage.getItem("userinfo")).canedit;e==2&&t!=1&&(console.log("start to hide",$(".list-edit-btn")),$(".list-edit-btn").hide(),$(".list-del-btn").hide(),$("#listBtns li.undis").hide())},100),h=!0}),e.listenTo(Backbone.Events,"search:done",function(){e.fetchData(),Backbone.Events.trigger("curstation:change",{})}),e.listenTo(Backbone.Events,"export:done",function(){console.log(e.downloadUrl,window.location.hash);if(!e.downloadUrl)return;console.log(e.downloadUrl,window.location.hash);var t=n.getSites(),r;this.ids&&this.ids.sid?r=this.ids.sid:r=t.ids.join(",");var i=window.location.hash;if(window.location.hash.indexOf("/qurey/")>-1){var s=$("#beginTime").val(),o=$("#endTime").val();s&&o&&(s=+(new Date(s)),o=+(new Date(o)));if(i.indexOf("Group")>-1)t=n.getGroups(),r=t.ids.join(",");else if(i.indexOf("Battery")>-1){var u=n.getBatterys();r=u?u.ids.join(","):""}if(this.downloadUrl.indexOf("?")>-1)var a=e.downloadUrl+"&isdownload=1&start="+s+"&end="+o+"&id="+r;else var a=e.downloadUrl+"?isdownload=1&start="+s+"&end="+o+"&id="+r;window.location=a}else if(window.location.hash.indexOf("/report/")>-1){var s=$("#beginTime").val(),o=$("#endTime").val();s&&o&&(s=+(new Date(s)),o=+(new Date(o)));var f=$("#cationCategory").val();if(this.downloadUrl.indexOf("?")>-1)var a=e.downloadUrl+"&isdownload=1&start="+s+"&end="+o+"&id="+r;else var a=e.downloadUrl+"?isdownload=1&start="+s+"&end="+o+"&id="+r;window.location=a}}),e.listenTo(Backbone.Events,"listdata:refresh",function(){Backbone.Events.trigger("curstation:change",{}),e.refresh()}),e.listenTo(Backbone.Events,"listdata:update:fail stationdata:get:fail",function(t){if(t.response.code=="-1"){h=!0,e.data=[];var n=/qurey/.test(window.location.href)?1:0;e.render(n)}}),e.listenTo(Backbone.Events,"listitem:delete",function(t){alert("删除成功"),e.refresh()}),e.listenTo(Backbone.Events,"curstation:change",function(t){e.ids=null;if(!$(e.el).length||!$(e.el).is(":visible"))return;var n=e.getNavData();if(typeof n=="undefined"||!n||!n.ids.length){e.data=[];var r=/qurey/.test(window.location.href)?1:0;e.render(r)}else e.fetchData()}),e.extEvent&&e.extEvent()},openStationInfoDialog:function(){r.show()},getCols:function(e){var t=o.cookie.getCookie(e+"Cols"),n=i.getListCols(e),r=[],s=0;return t?(t=t.split(","),r=o.filterArray(n,t,"data")):r=n,$.each(r,function(e,t){s+=parseInt(t.width)||0}),{data:r,width:s}},inRow:function(e){var t=this;t.changeRowClass($(e.currentTarget),"highlight")},changeRowClass:function(e,t){var n=this,r=e.index(),i=$("tbody",n.el),s=n.getRowData(e);return!s||!s.data?this:(i.each(function(e,n){var i=$(n);i.find("tr").eq(r).toggleClass(t)}),this)},selectRow:function(e){var t=this;t.changeRowClass($(e.currentTarget),"selected").triggerSelectEvent()},destroy:function(){this.remove(),this.destoryPlugin(),this.clearTables(),$("#dataItem").off("click")},triggerSelectEvent:function(){var e=this,t=e.listPlugin[0]?e.listPlugin[0].rows(".selected").data():[],n=[];$.each(t,function(e,t){n.push(t.sn_key)}),Backbone.Events.trigger("row:select",n)},getRowData:function(e){var t={};return $.each(this.listPlugin,function(n,r){t.data=r.row(e).data();if(t.data)return t.index=r.row(e).index(),!1}),t},resetScrollBar:function(){},refresh:function(){this.curPage=1,this.fetchData()},updateList:function(){var e=this,t=[].concat(e.data),n=t.length;e.listPlugin[0].rows().remove(),t.length&&e.listPlugin[0].rows.add(t).draw(),e.listPlugin[0].fixedColumns&&(e.listPlugin[0].fixedColumns().update(),e.listPlugin[0].fixedColumns().relayout()),e.listPlugin[0].draw(),e.checkAllRows()},fetchData:function(e){var e=e||{};e.page=this.curPage,t.getStationRealTimeData(e)},getParam:function(){var e=i.getCurStations(),t=i.getListType();return{listType:t}},getColumnDefs:function(){return[{targets:0,render:function(e,t,n){return'<label class="show-info">'+e+"</label>"}}]},changeListBottom:function(e){},destoryPlugin:function(){return this.clearTables(),this.listPlugin=[],this},clearTables:function(){try{$.fn.dataTable.isDataTable("#auto table")&&(this.listPlugin[0].clear(),this.listPlugin[0].destroy()),$("#list").html($("#defaultListTpl").html())}catch(e){}},render:function(){},renderChart:function(){},onAddStation:function(){}}},station:{extObj:{getNavData:function(){return n.getSites()},selectedIds:null,events:{"click .show_station_detail":"show_station_detail"},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"stationColsChange",function(t){console.log("station col change"),e.destoryPlugin(),e.render()})},show_station_detail:function(e){var t=[$(e.currentTarget).attr("id")];console.log("station pop clicked"),console.log("id",t);if(t<0){alert("请选择站点");return}for(var n=0;n<t.length;n++)t[n]=t[n];r.show(t.join(","))},fetchData:function(){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),$.extend(e,{id:i}),this.selectedIds=i,t.getStationRealTimeData(e)},renderChart:function(){console.log("chart data",this.data);var e=$("#down .btn-wrap .btn-bg"),t=null;for(var n=0;n<e.length;n++)if($(e[n]).css("display")=="block"){console.log("yes block"),t=$(e[n]).find(".active").attr("field");break}console.log(t)},render:function(t){var n=this,r=n.getCols(t==1?"qurey_station":"station");return console.log(t),n.listPlugin&&n.listPlugin[0]?n.updateList():e(["fixedColumn"],function(){if(r.width+580>$("#list").width())p.fixedColumns={leftColumns:2};else try{delete r.data[r.data.length-1].width}catch(e){}console.log(s.getListWidth()),n.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:n.data,scrollX:s.getListWidth(),scrollY:s.getListHeight(),columns:[{data:"site_name",title:"站名",width:150,sClass:"site_name_left",render:function(e,t,n){return"<div class='show_station_detail' style='color:blue;cursor:pointer;' id='"+n.sn_key+"'>"+e+"</div>"}},{data:"sid",title:"站号",width:50}].concat(r.data)},p))),n.checkAllRows()}),s.resizeAutoListWidth(),this}}},battery:{extObj:{prevIds:[],curStation:"",onNext:function(){this.nextStation(),this._fetch()},onPrev:function(){this.prevStation(),this._fetch()},nextStation:function(){if(!this.stations||!this.stations.ids.length)return;$("#page").show(),this.curStation&&this.prevIds.push(this.curStation),this.curStation=this.stations.ids.shift()},prevStation:function(){if(!this.prevIds.length)return;$("#page").show(),this.curStation&&this.stations.ids.unshift(this.curStation),this.curStation=this.prevIds.pop()},updatePageView:function(){$("#page .prev,#page .next").hide(),this.prevIds.length>0&&$("#page .prev").show(),this.stations.ids.length>0&&$("#page .next").show()},getBatterys:function(){var e=this.stations,t=this.curStation;this.stations.ids=this.stations.ids.sort(function(e,t){return e-t}),console.log(e,t);var r=n.getBatterys(t);return t&&($("#page .cur").html("当前站点："+e.map[t].title),this.updatePageView()),r?r.ids.join(","):""},updateStations:function(){return this.stations=n.getSites(),console.log("stations",this.stations),this.prevIds=[],this.curStation="",this},refresh:function(){this._fetch()},getNavData:function(){return n.getBatterys(this.curStation)},fetchData:function(){this.updateStations(),this.curStation||(this.curStation=this.stations[0]),this.nextStation(),this._fetch()},_fetch:function(){var e=this,n={};$.extend(n,{id:this.getBatterys()});if(!n.id){e.data=[],e.listPlugin&&e.listPlugin[0]?e.updateList():e.render();return}console.log("_param"+$.toJSON(n)),t.getBatterysRealTimeData(n)},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"batteryColsChange",function(t){e.destoryPlugin(),e.render()}),$("#dataItem").on("click","#page .prev",function(){e.onPrev()}),$("#dataItem").on("click","#page .next",function(){e.onNext()})},render:function(t){var n=this,r=n.getCols(t==1?"qurey_battery":"battery");return this.data.length==0&&$("#page").hide(),n.listPlugin&&n.listPlugin[0]?n.updateList():(console.log("colums.width",r.width),console.log("list.width",$("#list").width()),e(["fixedColumn"],function(){if(r.width+450>$("#list").width())console.log("width >"),p.fixedColumns={leftColumns:4};else try{delete r.data[r.data.length-1].width}catch(e){}n.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:n.data,scrollX:s.getListWidth(),scrollY:s.getListHeight(),leftColumns:4,columns:[{data:"site_name",title:"站名",width:120,sClass:"site_name_left"},{data:"sid",title:"站号",width:50},{data:"gid",title:"组号",width:50},{data:"bid",title:"电池号",width:50}].concat(r.data)},p))),n.checkAllRows()})),this}}},group:{extObj:{getNavData:function(){return n.getGroups()},fetchData:function(){var e={},r=n.getGroups();$.extend(e,{id:r.ids.join(",")}),t.getGroupsData(e)},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"groupColsChange",function(t){e.destoryPlugin(),e.render()})},render:function(t){var n=this,r=n.getCols(t==1?"qurey_group":"group");return n.listPlugin&&n.listPlugin[0]?n.updateList():e(["fixedColumn"],function(){if(r.width+530>$("#list").width())p.fixedColumns={leftColumns:3};else try{delete r.data[r.data.length-1].width}catch(e){}n.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:n.data,scrollX:s.getListWidth(),scrollY:s.getListHeight(),columns:[{data:"site_name",title:"站名",width:120,sClass:"site_name_left"},{data:"sid",title:"站号",width:50},{data:"gid",title:"组号",width:50}].concat(r.data)}))),n.checkAllRows()}),this}}},caution:{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){var e={page:this.curPage},r=n.getSites();$.extend(e,{id:r.ids.join(","),type:0}),t.getCautionsData(e)},events:{"click .resolveBtn":"resove","click .show_station_detail":"show_station_detail"},show_station_detail:function(e){var t=[$(e.currentTarget).attr("id")];console.log("station pop clicked"),console.log("id",t);if(t<0){alert("请选择站点");return}for(var n=0;n<t.length;n++)t[n]=t[n];r.show(t.join(","))},resove:function(e){s.showUnsolveDialog({id:$(e.currentTarget).attr("pid"),suggestion:$(e.currentTarget).attr("suggestion")})},updateAtype:function(){console.log("atypes",this.types);for(var e=0;e<this.types.length;e++){var t=this.types[e];t.atype=="R"?$("#ared").html(t.count+"条"):t.atype=="O"?$("#aoo").html(t.count+"条"):t.atype=="Y"&&$("#ayellow").html(t.count+"条")}},render:function(){var e=this;return e.listPlugin&&e.listPlugin[0]?(e.updateList(),e.updateAtype()):(e.updateAtype(),this.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:this.data,paging:!1,scrollX:s.getListHeight(),columns:[{data:"site_name",title:"站名",width:150,sClass:"site_name_left",render:function(e,t,n){return"<div class='show_station_detail' style='color:blue;cursor:pointer;' id='"+(n.sn_key.substring(0,10)+"0000")+"'>"+e+"</div>"}},{data:"sn_key",title:"站号",width:100,render:function(e,t,n){return n.sid}},{data:"sn_key",title:"组号",width:100,render:function(e,t,n){return n.type=="battery"||n.type=="group"?n.sn_key.substring(10,12):""}},{data:"sn_key",title:"电池号",width:100,render:function(e,t,n){return n.type=="battery"?n.sn_key.substring(12,14):""}},{data:"time",title:"时间",width:200},{data:"desc",title:"警情内容",width:200,render:function(e,t,n){var r=n.desc,i="";return r.indexOf("橙")>-1?i="#e7691d":r.indexOf("黄")>-1?i="#fabd05":i="#f20f0f","<div style='color:"+i+"'>"+e+"</div>"}},{data:"current",title:"数值",width:80,render:function(e,t,n){var r=n.desc,i="";return r.indexOf("橙")>-1?i="#e7691d":r.indexOf("黄")>-1?i="#fabd05":i="#f20f0f","<div style='font-weight:bold;color:"+i+"'>"+e+"</div>"}},{data:"climit",title:"参考值",width:80},{data:"markup",title:"操作记录",width:400,render:function(e){var t=e==null?"":e;return'<div style="text-align:left;">'+t+"</div>"}},{data:"id",title:"操作",width:100,render:function(e,t,n){return _.template('<a class="resolveBtn" pid="<%=id%>" suggestion="<%=suggest%>">处理</a>')({id:e,suggest:n.suggest})}}]})))),this}}},newstations:{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){var e={page:this.curPage};t.getNewStationData(e)},events:{"click .resolveBtn":"resove"},showStationOptionEditDialog:function(t){e(["dialogstationEdit"],function(e){e&&e.show(null,t)})},resove:function(e){var t=$(e.currentTarget);this.showStationOptionEditDialog({sid:t.attr("sid"),sn_key:t.attr("sn_key"),Groups:t.attr("Groups"),GroBats:t.attr("GroBats"),CurSensor:t.attr("CurSensor")})},updateAtype:function(){console.log("atypes",this.types);for(var e=0;e<this.types.length;e++){var t=this.types[e];t.atype=="R"?$("#ared").html(t.count+"条"):t.atype=="O"?$("#aoo").html(t.count+"条"):t.atype=="Y"&&$("#ayellow").html(t.count+"条")}},render:function(){var e=this;return e.listPlugin&&e.listPlugin[0]?e.updateList():this.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:this.data,paging:!1,scrollX:s.getListHeight(),columns:[{data:"sn_key",title:"物理地址"},{data:"CurSensor",title:"电流传感安装状态"},{data:"sid",title:"站号"},{data:"Groups",title:"组数"},{data:"GroBats",title:"电池数"},{data:"record_time",title:"时间"},{data:"id",title:"操作",width:150,render:function(e,t,n){return _.template('<a class="resolveBtn" sn_key="<%=sn_key%>" GroBats="<%=GroBats%>" sid="<%=sid%>" Groups="<%=Groups%>" CurSensor="<%=CurSensor%>" >添加</a>')(n)}}]}))),this}}},systemAlarm:{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){t.getSystemAlarm(e)},render:function(){var e=this;return e.listPlugin&&e.listPlugin[0]?e.updateList():this.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:this.data,paging:!1,scrollX:s.getListHeight(),columns:[{data:"site_name",title:"站名"},{data:"sid",title:"站号"},{data:"station",title:"物理地址"},{data:"record_time",title:"时间"},{data:"desc",title:"故障描述"},{data:"tips",title:"建议处理方式"}]}))),this}}},stationInfo_stationSituation:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-edit-text":"onEdit","click .list-del-btn":"onDel","click .list-validate-btn":"onValidate","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showStationEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此站点")&&(t.deleteStation({id:$(e.currentTarget).attr("pid")}),this.refresh())},onValidate:function(e){o.loadTips.show("校验中，请稍等..."),t.checkStation({id:$(e.currentTarget).attr("pid"),serial_number:$(e.currentTarget).attr("sn")})},extEvent:function(){var e=this;this.listenTo(Backbone.Events,"stationdata:delete",function(t){alert("删除成功"),e.refresh()}),this.listenTo(Backbone.Events,"station:check",function(t){o.loadTips.close(),alert("校验成功"),e.refresh()}),this.listenTo(Backbone.Events,"station:check:fail",function(e){o.loadTips.close(),alert("校验失败")})},getNavData:function(){return n.getSites()},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),$.extend(e,{id:i}),t.getStationsInfo(e)},render:function(){var t=this;return t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"sid",title:"站号",width:80},{data:"site_name",title:"站点简称",width:100,render:function(e,t,n){var r="";return r='<div class="list-edit-text" pid="'+n.id+'">'+n.site_name+"</div>",r}},{data:"serial_number",title:"物理地址",width:100},{data:"site_name",title:"站点全称",width:100,render:function(e,t,n){var r="";return r='<div class="list-edit-text" pid="'+n.id+'">'+n.StationFullChineseName+"</div>",r}},{data:"site_location",title:"站点地址",width:100},{data:"site_property",title:"站点性质",width:150},{data:"areaname",title:"隶属区域",width:150},{data:"fix_phone",title:"固定电话"},{data:"functionary",title:"负责人",width:120,render:function(e,t,n){var r=[];return n.functionary_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.functionary_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"functionary_phone",title:"负责人电话",width:120},{data:"device_owner",title:"设备负责人",width:120},{data:"device_owner_phone",title:"设备负责人电话",width:120},{data:"emergency_person",title:"紧急联系人姓名",width:120},{data:"emergency_phone",title:"紧急联系人手机",width:120},{data:"area_owner",title:"区域主管",width:120,render:function(e,t,n){var r=[];return n.area_owner_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.area_owner_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"area_owner_phone",title:"区域主管电话",width:120},{data:"parent_owner",title:"上级主管",width:120,render:function(e,t,n){var r=[];return n.parent_owner_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.parent_owner_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"parent_owner_phone",title:"上级主管电话"},{data:"groups",title:"电池组数",width:100},{data:"batteries",title:"每组电池数",width:80},{data:"postal_code",title:"邮政编码",width:80},{data:"site_latitude",title:"站点纬度",width:80},{data:"site_longitude",title:"站点经度",width:80},{data:"ipaddress",title:"IP地址",width:100},{data:"ipaddress_method",title:"控制器IP地址或方式",width:150},{data:"site_control_type",title:"站点控制器型号",width:100},{data:"bms_install_date",title:"BMS系统安装日期",width:150},{data:"group_collect_type",title:"组电流采集器型号",width:150},{data:"group_collect_num",title:"组电流采集器数量",width:150},{data:"inductor_brand",title:"互感器品牌",width:150},{data:"group_collect_install_type",title:"组电流采集器安装模式",width:150},{data:"battery_collect_type",title:"电池数据采集器型号",width:150},{data:"battery_collect_num",title:"电池数据采集器数量",width:150},{data:"humiture_type",title:"环境温湿度方式",width:150},{data:"has_light",title:"灯光报警",width:80},{data:"has_speaker",title:"声音报警",width:80},{data:"has_sms",title:"短信",width:80},{data:"has_smart_control",title:"智能控制",width:80},{data:"has_group_TH_control",title:"温湿度传感器",width:150},{data:"has_group_HO_control",title:"氢氧气传感器",width:150},{data:"device_mac",title:"网口MAC",width:150},{data:"remark",title:"备注",width:150},{data:"id",render:function(e,t,n){var r="";return n.is_checked=="1"?r='<div style="width:240px">'+$("#validateSuccess").html()+$("#editBtn").html()+$("#delBtn").html()+"</div>":r='<div style="width:240px">'+$("#validateBtn").html()+$("#editBtn").html()+$("#delBtn").html()+"</div>",_.template(r)({id:e,sn:n.serial_number})}}]},p))),t.checkAllRows()}),this}}},stationInfo_batterys:{extObj:{events:{"click .list-edit-btn":"onEdit","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showBatteryEditDialog($(e.currentTarget).attr("pid"))},fetchData:function(e){t.getBatteryInfosData(e)},render:function(){var t=this;return t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"电池数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"sid",title:"站号",width:100},{data:"site_name",title:"站点简称",width:100},{data:"battery_factory",title:"生产厂家",width:150},{data:"battery_num",title:"电池型号",width:150},{data:"battery_date",title:"生产日期",width:150},{data:"battery_voltage",title:"标称电压（V）",width:150},{data:"battery_oum",title:"标称内阻（MΩ）",width:150},{data:"battery_dianrong",title:"电池标称容量（Ah）",width:150},{data:"battery_float_voltage",title:"浮充标准电压（V）",width:150},{data:"battery_max_current",title:"最大充电电流（A）",width:150},{data:"battery_max_discharge_current",title:"最大放电电流（A）",width:150},{data:"battery_float_up",title:"浮充电压上限（V）",width:150},{data:"battery_float_dow",title:"电池浮充电压下限（V）",width:150},{data:"battery_discharge_down",title:"放电电压下限（V）",width:150},{data:"battery_scrap_date",title:"强制报废日期",width:150},{data:"battery_life",title:"设计寿命（年）",width:150},{data:"battery_column_type",title:"电池级柱类型",width:150},{data:"battery_temperature",title:"温度要求（℃）",width:150},{data:"battery_humidity",title:"湿度要求（%）",width:150},{data:"battery_type",title:"电池种类",width:150},{data:"battery_factory_phone",title:"电池厂家联系电话",width:150},{data:"remark",title:"备注",width:150},{data:"id",render:function(e){return _.template('<div style="width:160px">'+$("#editBtn").html()+"</div>")({id:e})}}]},p))),t.checkAllRows()}),this}}},stationInfo_upsInfo:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showUPSEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此UPS数据")&&t.deleteUps({id:$(e.currentTarget).attr("pid")})},fetchData:function(){t.getUpsInfosData()},render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"UPS数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"sid",title:"站号",width:80},{data:"site_name",title:"站名",width:250},{data:"ups_factory",title:"生产厂家",width:250},{data:"ups_type",title:"型号",width:100},{data:"ups_create_date",title:"生产日期",width:150},{data:"ups_install_date",title:"安装日期",width:150},{data:"ups_power",title:"功率/容量（W/H）",width:150},{data:"ups_power_in",title:"输入功率（W/A）",width:150},{data:"ups_power_out",title:"输出功率（W/A）",width:150},{data:"ups_battery_vol",title:"外接电池电压（V）",width:150},{data:"ups_battery_current",title:"外接电池电流（A）",width:150},{data:"ac_protect",title:"AC过流保护（V/A）",width:150},{data:"dc_protect",title:"DC过流保护（V/A）",width:150},{data:"on_net",title:"联网检测",width:150},{data:"alarm_content",title:"报警内容",width:150},{data:"discharge_protect",title:"放电保护值（%）",width:150},{data:"redundancy_num",title:"冗余数量(台)",width:150},{data:"floting_charge",title:"浮充电压（V）",width:150},{data:"ups_vdc",title:"电压范围(V)",width:150},{data:"ups_reserve_hour",title:"额定候备时间（W/H）",width:250},{data:"ups_charge_mode",title:"充电方式",width:100},{data:"ups_max_charge",title:"最大充电电流（A）",width:150},{data:"ups_max_discharge",title:"最大放电电流（A）",width:150},{data:"ups_period_days",title:"规定维护周期（天）",width:150},{data:"ups_discharge_time",title:"维护放电时长（分钟）",width:150},{data:"ups_discharge_capacity",title:"维护放电容量（%）",width:150},{data:"ups_maintain_date",title:"维护到期日",width:150},{data:"ups_vender_phone",title:"厂家联系电话",width:120},{data:"ups_service",title:"服务商名称",width:120},{data:"ups_vender",title:"联系人",width:120},{data:"ups_service_phone",title:"服务商电话",width:100},{data:"remark",title:"备注",width:150},{data:"id",render:function(e){return _.template('<div style="width:80px">'+$("#editBtn").html()+"</div>")({id:e})}}]},p))),t.checkAllRows()}),this}}},stationInfo_monitorSeller:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showBMSEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此UPS数据")&&t.deleteBMS({id:$(e.currentTarget).attr("pid")})},fetchData:function(){t.getBMSInfosData()},render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"bms_company",title:"生产厂家",width:200},{data:"bms_device_addr",title:"厂家地址",width:200},{data:"bms_postcode",title:"邮编",width:200},{data:"bms_url",title:"支持网址",width:200},{data:"bms_tel",title:"支持固话",width:200},{data:"bms_phone",title:"手机",width:200},{data:"bms_service_phone",title:"服务商电话",width:200},{data:"bms_service_name",title:"服务商名称",width:200},{data:"bms_service_contact",title:"服务商联系人",width:200},{data:"bms_service_url",title:"服务商地址",width:300},{data:"bms_version",title:"软件版本号",width:150},{data:"bms_update_mark",title:"软件升级记录",width:170},{data:"bms_mark",title:"备注",width:300},{data:"id",render:function(e){return _.template('<div style="width:160px">'+$("#editBtn").html()+$("#delBtn").html()+"</div>")({id:e})}}]},p))),t.checkAllRows()}),this}}},stationInfo_institutions:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showCompanyEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此UPS数据")&&t.deleteCompany({id:$(e.currentTarget).attr("pid")})},fetchData:function(){t.getCompanyInfosData()},render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"company_name",title:"单位名称",width:150},{data:"company_address",title:"单位地址",width:300},{data:"area_name",title:"管辖"},{data:"parent_area",title:"隶属",width:100},{data:"supervisor_name",title:"主管领导姓名",width:80},{data:"supervisor_phone",title:"主管领导电话",width:100},{data:"owner",title:"部门负责人",width:80},{data:"owner_phone",title:"部门负责人电话",width:100},{data:"longitude",title:"经度",width:80},{data:"latitude",title:"纬度",width:80},{data:"station_num",title:"所辖站点个数",width:80},{data:"area_level",title:"隶属层级",width:100},{data:"network_type",title:"联网方式",width:100},{data:"bandwidth",title:"网络带宽",width:100},{data:"ipaddr",title:"IP地址",width:100},{data:"computer_brand",title:"上位机品牌",width:100},{data:"computer_os",title:"上位机操作系统",width:100},{data:"computer_conf",title:"主机配置",width:100},{data:"browser_name",title:"浏览器名称",width:100},{data:"server_capacity",title:"服务器容量",width:100},{data:"server_type",title:"服务器型号",width:100},{data:"cloud_address",title:"云空间地址",width:100},{data:"backup_period",title:"数据备份周期",width:100},{data:"backup_type",title:"数据备份方式",width:100},{data:"supervisor_depname",title:"监控部门名称",width:100},{data:"monitor_name1",title:"监控部门负责人",width:100},{data:"monitor_phone1",title:"监控部门负责人电话",width:100},{data:"monitor_name2",title:"其他联系人",width:100},{data:"monitor_phone2",title:"其他联系人电话",width:100},{data:"monitor_name3",title:"其他联系人",width:100},{data:"monitor_phone3",title:"其他联系人电话",width:100},{data:"monitor_tel1",title:"监控部门固定电话1",width:100},{data:"monitor_tel2",title:"监控部门固定电话2",width:100},{data:"duty_status",title:"值守状态/班次",width:80},{data:"manage",title:"管理员",width:80},{data:"viewer",title:"观察员",width:80},{data:"remark",title:"备注",width:150},{data:"id",render:function(e){return _.template('<div style="width:160px">'+$("#editBtn").html()+$("#delBtn").html()+"</div>")({id:e})}}]},p))),t.checkAllRows()}),this}}},manager_role:{extObj:{fetchData:function(e){t.getRolesData(e)},render:function(){return this.destoryPlugin(),this.clearTables(),$("#addRole").hide(),$("#lock").hide(),$("#auto").width("100%"),this.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:this.data,scrollX:s.getListWidth(),columns:[{data:"",title:"序号"},{data:"id",title:"编号"},{data:"rolename",title:"角色名称"}]},p))),this}}},manager_personal:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel"},onEdit:function(e){s.showPersonalEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此人员")&&t.deletePersonal({id:$(e.currentTarget).attr("pid")})},fetchData:function(e){t.getPersonalsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"unit",title:"单位名称"},{data:"name",title:"姓名"},{data:"username",title:"登陆名"},{data:"phone",title:"联系电话"},{data:"backup_phone",title:"备用电话"},{data:"email",title:"邮箱"},{data:"postname",title:"职位"},{data:"duty_num",title:"班次"},{data:"location",title:"住址"},{data:"areaname",title:"管理范围",render:function(e){var t=e.split(" ");return t.length>1&&t.shift(),"<div>"+t.join(" ")+"</div>"}},{data:"rolename",title:"角色"},{data:"id",render:function(e){return _.template('<div style="width:160px">'+$("#editBtn").html()+$("#delBtn").html()+"</div>")({id:e})}}]}))),t.checkAllRows()}),this}}},message:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel","change .changed":"onChange","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onChange:function(e){var n=$(e.currentTarget).attr("field"),r=$(e.currentTarget).attr("dataid"),i=$(e.currentTarget).val();console.log(n,r,i),t.updateMessage({id:r,field:n,val:i})},fetchData:function(e){t.getMessagesData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"id",title:"ID"},{data:"desc",title:"描述",width:200},{data:"en",title:"编码"},{data:"ignore",title:"是否可忽略",width:100,render:function(e,t,n){var r=[];return r.push('<select class="changed" field="ignore" dataid='+n.id+">"),e=="1"?(r.push("<option value=1 selected>是</option>"),r.push("<option value=0>否</option>")):(r.push("<option value=1>是</option>"),r.push("<option value=0 selected>否</option>")),r.push("</select>"),r.join("")}},{data:"send_email",title:"是否发送邮件",width:100,render:function(e,t,n){var r=[];return r.push('<select class="changed" field="send_email" dataid='+n.id+">"),e=="1"?(r.push("<option value=1 selected>是</option>"),r.push("<option value=0>否</option>")):(r.push("<option value=1>是</option>"),r.push("<option value=0 selected>否</option>")),r.push("</select>"),r.join("")}},{data:"send_msg",title:"是否发送短信",width:100,render:function(e,t,n){var r=[];return r.push('<select class="changed" field="send_msg" dataid='+n.id+">"),e=="1"?(r.push("<option value=1 selected>是</option>"),r.push("<option value=0>否</option>")):(r.push("<option value=1>是</option>"),r.push("<option value=0 selected>否</option>")),r.push("</select>"),r.join("")}}]})))}),this}}},optionSetting_stationOption:{extObj:{events:{"click .list-edit-btn":"onEdit","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;t==1?s.showStationOptionEditDialog($(e.currentTarget).attr("pid")):alert("您无编辑权限")},fetchData:function(e){t.getSationOptionsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:3},columns:[{data:"sn_key",title:"站MAC",width:100},{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"Groups",title:"站内组数",width:100},{data:"GroBats",title:"每组电池数",width:100},{data:"CurSensor",title:"电流传感安装状态",width:100},{data:"Time_MR",title:"内阻测量间隔",width:100},{data:"SampleInt",title:"采集间隔",width:100},{data:"MaxTem_R",title:"高温报警_红",width:100},{data:"MaxTem_O",title:"高温报警_橙",width:100},{data:"MaxTem_Y",title:"高温报警_黄",width:100},{data:"MinTem_R",title:"低温报警_红",width:100},{data:"MinTem_O",title:"低温报警_橙",width:100},{data:"MinTem_Y",title:"低温报警_黄",width:100},{data:"MaxHum_R",title:"高湿报警_红",width:100},{data:"MaxHum_O",title:"高湿报警_橙",width:100},{data:"MaxHum_Y",title:"高湿报警_黄",width:100},{data:"MinHum_R",title:"低湿报警_红",width:100},{data:"MinHum_O",title:"低湿报警_橙",width:100},{data:"MinHum_Y",title:"低湿报警_黄",width:100},{data:"CurRange",title:"站电流量程",width:100},{data:"KI",title:"站电流系数",width:100},{data:"ZeroCurADC",title:"站电流零位",width:100},{data:"DisChaLim_R",title:"放电报警_红",width:100},{data:"DisChaLim_O",title:"放电报警_橙",width:100},{data:"DisChaLim_Y",title:"放电报警_黄",width:100},{data:"ChaLim_R",title:"充电报警_红",width:100},{data:"ChaLim_O",title:"充电报警_橙",width:100},{data:"ChaLim_Y",title:"充电报警_黄",width:100},{data:"HiVolLim_R",title:"高压报警_红",width:100},{data:"HiVolLim_O",title:"高压报警_橙",width:100},{data:"HiVolLim_Y",title:"高压报警_黄",width:100},{data:"LoVolLim_R",title:"低压报警_红",width:100},{data:"LoVolLim_O",title:"低压报警_橙",width:100},{data:"LoVolLim_Y",title:"低压报警_黄",width:100},{data:"ChaCriterion",title:"站充放电判据",width:100},{data:"sn_key",render:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;return t!=1?"":_.template($("#editBtn").html())({id:e})}}]})))}),this}}},optionSetting_groupOption:{extObj:{events:{"click .list-edit-btn":"onEdit","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;t==1?s.showGroupOptionEditDialog($(e.currentTarget).attr("pid")):alert("您无编辑权限")},fetchData:function(e){t.getGroupOptionData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"GroBatNum",title:"每组电池数",width:100},{data:"CurRange",title:"组电流量程",width:100},{data:"KI",title:"组电流系数",width:100},{data:"ZeroCurADC",title:"组电流零位",width:100},{data:"DisChaLim_R",title:"组放电电流超上限_红",width:100},{data:"DisChaLim_O",title:"组放电电流将达上限_橙",width:100},{data:"DisChaLim_Y",title:"组放电电流偏高_黄",width:100},{data:"ChaLim_R",title:"组充电电流超上限_红",width:100},{data:"ChaLim_O",title:"组充电电流将达上限_橙",width:100},{data:"ChaLim_Y",title:"组充电电流偏高_黄",width:100},{data:"MaxTem_R",title:"组温度超上限_红",width:100},{data:"MaxTem_O",title:"组温度将达上限_橙",width:100},{data:"MaxTem_Y",title:"组温度偏高_黄",width:100},{data:"MinTem_R",title:"组温度超下限_红",width:100},{data:"MinTem_O",title:"组温度将达下限_橙",width:100},{data:"MinTem_Y",title:"组温度偏低_黄",width:100},{data:"ChaCriterion",title:"组充放电判据",width:100},{data:"sn_key",render:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;return t!=1?"":_.template($("#editBtn").html())({id:e})}}]})))}),this}}},optionSetting_batteryOption:{extObj:{events:{"click .list-edit-btn":"onEdit","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;t==1?s.showBatteryOptionEditDialog($(e.currentTarget).attr("pid")):alert("您无编辑权限")},fetchData:function(e){t.getBatteryOptionsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"KV",title:"电压系数",width:100},{data:"KT",title:"温度系数",width:100},{data:"KI",title:"激励电流系数",width:100},{data:"T0",title:"T0校准温度",width:100},{data:"ADC_T0",title:"T0温度码",width:100},{data:"T1",title:"T1校准温度",width:100},{data:"ADC_T1",title:"T1温度码",width:100},{data:"MaxU_R",title:"电池电压超上限_红",width:100},{data:"MaxU_O",title:"电池电压将达上限_橙",width:100},{data:"MaxU_Y",title:"电池电压偏高_黄",width:100},{data:"MinU_R",title:"电池电压超下限_红",width:100},{data:"MinU_O",title:"电池电压将达下限_橙",width:100},{data:"MinU_Y",title:"电池电压偏低_黄",width:100},{data:"MaxT_R",title:"电池温度超上限_红",width:100},{data:"MaxT_O",title:"电池温度将达上限_橙",width:100},{data:"MaxT_Y",title:"电池温度偏高_黄",width:100},{data:"MinT_R",title:"电池温度超下限_红",width:100},{data:"MinT_O",title:"电池温度将达下限_橙",width:100},{data:"MinT_Y",title:"电池温度偏低_黄",width:100},{data:"MaxR_R",title:"电池内阻超上限_红",width:100},{data:"MaxR_O",title:"电池内阻将达上限_橙",width:100},{data:"MaxR_Y",title:"电池内阻偏高_黄",width:100},{data:"MaxDevU_R",title:"电池电压偏差_红",width:100},{data:"MaxDevU_O",title:"电池电压偏差_橙",width:100},{data:"MaxDevU_Y",title:"电池电压偏差_黄",width:100},{data:"MaxDevT_R",title:"电池温度偏差_红",width:100},{data:"MaxDevT_O",title:"电池温度偏差_橙",width:100},{data:"MaxDevT_Y",title:"电池温度偏差_黄",width:100},{data:"MaxDevR_R",title:"电池内阻偏差_红",width:100},{data:"MaxDevR_O",title:"电池内阻偏差_橙",width:100},{data:"MaxDevR_Y",title:"电池内阻偏差_黄",width:100},{data:"sn_key",render:function(e){var t=JSON.parse(localStorage.getItem("userinfo")).role;return t!=1?"":_.template($("#editBtn").html())({id:e})}}]})))}),this}}},limitationSetting:{extObj:{events:{"click .list-edit-btn":"onEdit","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showLimitationEditDialog($(e.currentTarget).attr("pid"))},fetchData:function(e){t.getStationsInfo(e)},render:function(){var t=this;t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:100},{data:"site_name",title:"站点简称",width:200},{data:"serial_number",title:"物理地址",width:250},{data:"serial_number",render:function(e){return _.template('<div style="width:80px; margin:0px auto">'+$("#editBtn").html()+"</div>")({id:e})}}]},p)))})}}},equipmentSetting:{extObj:{events:{"click .list-edit-btn":"onEdit","click .list-del-btn":"onDel","mouseover .dataTable tr":"inRow","mouseout .dataTable tr":"inRow"},onEdit:function(e){s.showStationdeviceEditDialog($(e.currentTarget).attr("pid"))},onDel:function(e){confirm("是否确定删除此外控设备")&&t.deleteStationdevice({id:$(e.currentTarget).attr("pid")})},fetchData:function(e){t.getStationdeviceInfos(e)},render:function(){var t=this;t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:100},{data:"Device_name",title:"名称",width:100},{data:"Device_fun",title:"功能",width:100},{data:"Device_Factory_Name",title:"生产厂家",width:100},{data:"Device_Factory_Address",title:"厂家地址",width:200},{data:"Device_Factory_PostCode",title:"厂家邮编",width:100},{data:"Device_Factory_website",title:"技术支持网址",width:150},{data:"Device_Factory_Technology_cable_phone",title:"技术支持固话",width:100},{data:"Device_Factory_Technology_cellphone",title:"技术支持手机",width:100},{data:"id",render:function(e){return _.template('<div style="width:160px; margin:0px auto">'+$("#editBtn").html()+$("#clearBtn").html()+"</div>")({id:e})}}]},p)))})}}},reportCaution:{extObj:{fetchData:function(){var e=$("#cationCategory").val(),n={page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""};e>0&&(n.type=e),t.getGerneralalarmlog(n)},downloadUrl:"/api/index.php/gerneralalarm",render:function(){var e=this;e.destoryPlugin(),e.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:e.data,language:{emptyTable:"报表数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"alarm_sn",title:"序号"},{data:"alram_equipment",title:"站名",render:function(e,t,n){var r=["red","green","#f90"];return'<span style="color:white;background-color:'+r[n.alarm_emergency_level-1]+'">'+n.alram_equipment+"</span>"}},{data:"alarm_para1_name",title:"站号"},{data:"alarm_para2_name",title:"组号"},{data:"alarm_para3_name",title:"电池号"},{data:"alarm_occur_time",title:"时间"},{data:"alarm_content",title:"警情内容"},{data:"alarm_para1_value",title:"数值"},{data:"alarm_suggestion",title:"建议处理方式"}]},p)))}}},batteryLife:{extObj:{fetchData:function(e){var n={page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""};t.getByearlog(n)},downloadUrl:"/api/index.php/report/byearlog",render:function(){var e=this;e.destoryPlugin(),e.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:e.data,language:{emptyTable:"报表数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"brand",title:"品牌",width:100},{data:"battery_date",title:"生产日期",width:100},{data:"battery_install_date",title:"电池安装日期",width:100},{data:"U",title:"电池的电压",width:100},{data:"battery_oum",title:"出厂标称内阻",width:200},{data:"R",title:"电池的内阻",width:100},{data:"battery_scrap_date",title:"强制报废日期"}]},p)))}}},deviationTrend:{extObj:{fetchData:function(e){var n={page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""};t.getDeviationTrend(n)},downloadUrl:"/api/index.php/report/deviationTrend",render:function(){var e=this;e.destoryPlugin(),e.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:e.data,language:{emptyTable:"报表数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"site_name",title:"站名",width:100},{data:"sid",title:"站号",width:100},{data:"record_time",title:"时间",width:100},{data:"avgU",title:"电压均值",width:100,render:function(e){return e?parseFloat(e).toFixed(2):""}},{data:"avgT",title:"温度均值",width:100,render:function(e){return e?parseFloat(e).toFixed(2):""}},{data:"avgR",title:"内阻均值",width:100,render:function(e){return e?parseFloat(e).toFixed(2):""}},{data:"avgU",title:"电压偏离度(%)",render:function(e){return e?(Math.abs(.3-e)/.3*100).toFixed(2):""}},{data:"avgT",title:"温度偏离度(%)",render:function(e){return e?(Math.abs(3-e)/3*100).toFixed(2):""}},{data:"avgR",title:"内阻偏离度(%)",render:function(e){return e?(Math.abs(5-e)/5*100).toFixed(2):""}}]},p)))}}},chargeOrDischarge:{extObj:{fetchData:function(e){var n={page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""};t.getChargeOrDischarge(e)},render:function(){var e=this;e.destoryPlugin(),e.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:e.data,language:{emptyTable:"报表数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"time",title:"序号",width:100},{data:"record_time",title:"记录时间",width:200},{data:"sid",title:"站点id",width:100},{data:"site_name",title:"站点名称",width:300},{data:"BBbCharge",title:"充电状态",width:100,render:function(e){return e==1?"是":"否"}},{data:"BCbDisCharge",title:"放电状态",render:function(e){return e==1?"是":"否"}}]},p)))}}},reportUilog_options:{extObj:{fetchData:function(e){t.getUserlog({page:this.curPage,type:"2",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},render:function(){var e=this;e.destoryPlugin(),e.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:e.data,language:{emptyTable:"UI日志数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"username",title:"用户",width:100},{data:"content",title:"操作内容",render:function(e,t,n){if(!n.newvalue)return n.content;var r=JSON.parse(n.newvalue);if(r.site_name){var i=r.site_name;return i=unescape(i.replace(/(u[a-z0-9]{4,4})/g,"%$1")),console.log(i),n.content+"(站名:"+i+")"}return n.content}},{data:"modify_time",title:"操作时间",width:150}]},p)))},downloadUrl:"/api/index.php/userlog?type=2"}}};return d.reportUilog_user=$.extend(!0,{},d.reportUilog_options,{extObj:{fetchData:function(e){t.getUserlog({page:this.curPage,type:"1",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/userlog?type=1"}}),d.reportUilog_other=$.extend(!0,{},d.reportUilog_options,{extObj:{fetchData:function(e){t.getUserlog({page:this.curPage,type:"3",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/userlog?type=3"}}),d.uilog_options=$.extend(!0,{},d.reportUilog_options,{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){t.getUserlog({page:this.curPage,type:"2",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/userlog?type=2"}}),d.uilog_user=$.extend(!0,{},d.reportUilog_user,{extObj:{fetchData:function(e){t.getUserlog({page:this.curPage,type:"1",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/userlog?type=1"}}),d.uilog_other=$.extend(!0,{},d.reportUilog_other,{extObj:{fetchData:function(e){t.getUserlog({page:this.curPage,type:"3",start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/userlog?type=3"}}),d.qureyStation=$.extend(!0,{},d.station,{extObj:{extEvent:function(){var e=this;e.listenTo(Backbone.Events,"qurey_stationColsChange",function(t){console.log("query station col change"),e.destoryPlugin(),e.render(1)})},fetchData:function(){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),$.extend(e,{id:i});if($("#beginTime").val()==""){alert("请选择时间");return}if($("#startTime").val()==""){alert("请选择时间");return}t.getStationHistoryData({id:i,page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/query/"}}),d.qureyGroup=$.extend(!0,{},d.group,{extObj:{extEvent:function(){var e=this;e.listenTo(Backbone.Events,"qurey_groupColsChange",function(t){e.destoryPlugin(),e.render(1)})},fetchData:function(e){var e={},r,i=n.getGroups();if($("#beginTime").val()==""){alert("请选择时间");return}if($("#startTime").val()==""){alert("请选择时间");return}t.getGroupHistoryData({id:i.ids.join(","),page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},downloadUrl:"/api/index.php/query/groupmodule"}}),d.qureyBattery=$.extend(!0,{},d.battery,{extObj:{extEvent:function(){var e=this;e.listenTo(Backbone.Events,"qurey_batteryColsChange",function(t){e.destoryPlugin(),e.render(1)})},fetchData:function(e){var e={},r=n.getBatteryIds(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(",");if($("#beginTime").val()==""){alert("请选择时间");return}if($("#startTime").val()==""){alert("请选择时间");return}t.getBatteryHistoryData({id:i,page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},refresh:function(){this.fetchData()},downloadUrl:"/api/index.php/query/batterymodule"}}),d.qureyCaution=$.extend(!0,{},d.caution,{extObj:{fetchData:function(e){var e={},r=n.getBatteryIds(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(",");if($("#beginTime").val()==""){alert("请选择时间");return}if($("#startTime").val()==""){alert("请选择时间");return}var s=$("#cationCategory").val();t.getCautionsData({cautionType:s,type:1,id:i,page:this.curPage,start:$("#beginTime").val()?+(new Date($("#beginTime").val())):"",end:$("#endTime").val()?+(new Date($("#endTime").val())):""})},refresh:function(){this.fetchData()},downloadUrl:"/api/index.php/query/batterymodule",render:function(){var e=this;return e.listPlugin&&e.listPlugin[0]?(e.updateList(),e.updateAtype()):(e.updateAtype(),this.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:this.data,paging:!1,scrollX:s.getListHeight(),columns:[{data:"site_name",title:"站名",width:150,sClass:"site_name_left",render:function(e,t,n){return"<div class='show_station_detail' style='color:blue;cursor:pointer;' id='"+(n.sn_key.substring(0,10)+"0000")+"'>"+e+"</div>"}},{data:"sn_key",title:"站号",width:80,render:function(e,t,n){return n.sid}},{data:"sn_key",title:"组号",width:80,render:function(e,t,n){return n.type=="battery"||n.type=="group"?n.sn_key.substring(10,12):""}},{data:"sn_key",title:"电池号",width:80,render:function(e,t,n){return n.type=="battery"?n.sn_key.substring(12,14):""}},{data:"time",title:"时间",width:200},{data:"desc",title:"警情内容",width:200,render:function(e,t,n){var r=n.desc,i="";return r.indexOf("橙")>-1?i="#e7691d":r.indexOf("黄")>-1?i="#fabd05":i="#f20f0f","<div style='color:"+i+"'>"+e+"</div>"}},{data:"current",title:"数值",width:80,render:function(e,t,n){var r=n.desc,i="";return r.indexOf("橙")>-1?i="#e7691d":r.indexOf("黄")>-1?i="#fabd05":i="#f20f0f","<div style='font-weight:bold;color:"+i+"'>"+e+"</div>"}},{data:"markup",title:"操作记录",render:function(e,t,n){var r=e==null?"":e;return n.status==2?'<div style="text-align:left;">已忽略</div>':'<div style="text-align:left;">'+r+"</div>"}},{data:"contact",title:"操作人",width:80},{data:"markuptime",title:"操作时间",width:200}]})))),this}}}),d.IRCollect=$.extend(!0,{},d.station,{extObj:{fetchData:function(e){var e={};e.page=this.curPage,t.getIRCollectData(e)},downloadUrl:"/api/index.php/query/groupmodule",extEvent:function(){var e=this;this.listenTo(Backbone.Events,"rCollect:start",function(t){o.loadTips.show("正在与站点联系采集相关电池内阻，请稍后"),setTimeout(function(){o.loadTips.close()},5e3),$("body").everyTime("2s","irc",function(){console.log("get IRCollect"),e.fetchData()})}),this.listenTo(Backbone.Events,"rCollect:start:fail",function(e){o.loadTips.show("采集失败，请重试"),setTimeout(function(){o.loadTips.close()},5e3)})},render:function(){var t=this;t.listPlugin&&t.listPlugin[0]?t.updateList():e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"采集内阻数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:100},{data:"site_name",title:"站点简称",width:200},{data:"stationid",title:"物理地址"},{data:"groupid",title:"组号"},{data:"batteryid",title:"电池号"},{data:"R",title:"内阻值"},{data:"collect_time",title:"完成时间"}]},p)))})}}}),d.adminConfig=$.extend(!0,{},d.station,{extObj:{fetchData:function(e){t.getPersonalsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"unit",title:"单位名称"},{data:"name",title:"姓名"},{data:"username",title:"登陆名"},{data:"phone",title:"联系电话"},{data:"backup_phone",title:"备用电话"},{data:"email",title:"邮箱"},{data:"postname",title:"职位"},{data:"duty_num",title:"班次"},{data:"location",title:"住址"},{data:"areaname",title:"管理范围",render:function(e){var t=e.split(" ");return t.length>1&&t.shift(),"<div>"+t.join(" ")+"</div>"}},{data:"rolename",title:"角色"}]}))),t.checkAllRows()}),this}}}),d.limitation=$.extend(!0,{},d.limitationSetting,{extObj:{render:function(){var t=this;t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:100},{data:"site_name",title:"站点简称",width:200},{data:"serial_number",title:"物理地址"}]},p)))})}}}),d.baseinfo_queryStationSituation=$.extend(!0,{},d.stationInfo_stationSituation,{extObj:{downloadUrl:"/api/index.php/query",getNavData:function(){return n.getSites()},render:function(){var t=this;return t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"sid",title:"站号",width:80},{data:"site_name",title:"站点简称",width:100},{data:"serial_number",title:"物理地址",width:100},{data:"site_name",title:"站点全称",width:100},{data:"site_location",title:"站点地址",width:100},{data:"site_property",title:"站点性质",width:150},{data:"areaname",title:"隶属区域",width:150},{data:"fix_phone",title:"固定电话"},{data:"functionary",title:"负责人",width:120,render:function(e,t,n){var r=[];return n.functionary_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.functionary_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"functionary_phone",title:"负责人电话",width:120},{data:"device_owner",title:"设备负责人",width:120},{data:"device_owner_phone",title:"设备负责人电话",width:120},{data:"emergency_person",title:"紧急联系人姓名",width:120},{data:"emergency_phone",title:"紧急联系人手机",width:120},{data:"area_owner",title:"区域主管",width:120,render:function(e,t,n){var r=[];return n.area_owner_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.area_owner_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"area_owner_phone",title:"区域主管电话",width:120},{data:"parent_owner",title:"上级主管",width:120,render:function(e,t,n){var r=[];return n.parent_owner_sms&&(r.push("<span>"),r.push('<img src="/images/sms.png">'),r.push("</span>")),n.parent_owner_mail&&(r.push("<span>"),r.push('<img src="/images/email.png">'),r.push("</span>")),"<span>"+e+"</span>"+r.join("")}},{data:"parent_owner_phone",title:"上级主管电话"},{data:"groups",title:"电池组数",width:100},{data:"batteries",title:"每组电池数",width:80},{data:"postal_code",title:"邮政编码",width:80},{data:"site_latitude",title:"站点纬度",width:80},{data:"site_longitude",title:"站点经度",width:80},{data:"ipaddress",title:"IP地址",width:100},{data:"ipaddress_method",title:"控制器IP地址或方式",width:150},{data:"site_control_type",title:"站点控制器型号",width:100},{data:"bms_install_date",title:"BMS系统安装日期",width:150},{data:"group_collect_type",title:"组电流采集器型号",width:150},{data:"group_collect_num",title:"组电流采集器数量",width:150},{data:"inductor_brand",title:"互感器品牌",width:150},{data:"group_collect_install_type",title:"组电流采集器安装模式",width:150},{data:"battery_collect_type",title:"电池数据采集器型号",width:150},{data:"battery_collect_num",title:"电池数据采集器数量",width:150},{data:"humiture_type",title:"环境温湿度方式",width:150},{data:"has_light",title:"灯光报警",width:80},{data:"has_speaker",title:"声音报警",width:80},{data:"has_sms",title:"短信",width:80},{data:"has_smart_control",title:"智能控制",width:80},{data:"has_group_TH_control",title:"温湿度传感器",width:150},{data:"has_group_HO_control",title:"氢氧气传感器",width:150},{data:"device_mac",title:"网口MAC",width:150},{data:"remark",title:"备注",width:150}]},p)))}),this}}}),d.baseinfo_queryBatterys=$.extend(!0,{},d.stationInfo_batterys,{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),console.log(r),$.extend(e,{id:i}),t.getBatteryInfosData(e)},downloadUrl:"/api/index.php/query/batterymodule",render:function(){var t=this;return t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"电池数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:100},{data:"site_name",title:"站点简称",width:100},{data:"battery_factory",title:"生产厂家",width:150},{data:"battery_num",title:"电池型号",width:150},{data:"battery_date",title:"生产日期",width:150},{data:"battery_voltage",title:"标称电压（V）",width:150},{data:"battery_oum",title:"标称内阻（MΩ）",width:150},{data:"battery_dianrong",title:"电池标称容量（Ah）",width:150},{data:"battery_float_voltage",title:"浮充标准电压（V）",width:150},{data:"battery_max_current",title:"最大充电电流（A）",width:150},{data:"battery_max_discharge_current",title:"最大放电电流（A）",width:150},{data:"battery_float_up",title:"浮充电压上限（V）",width:150},{data:"battery_float_dow",title:"电池浮充电压下限（V）",width:150},{data:"battery_discharge_down",title:"放电电压下限（V）",width:150},{data:"battery_scrap_date",title:"强制报废日期",width:150},{data:"battery_life",title:"设计寿命（年）",width:150},{data:"battery_column_type",title:"电池级柱类型",width:150},{data:"battery_temperature",title:"温度要求（℃）",width:150},{data:"battery_humidity",title:"湿度要求（%）",width:150},{data:"battery_type",title:"电池种类",width:150},{data:"battery_factory_phone",title:"电池厂家联系电话",width:150},{data:"remark",title:"备注",width:150}]},p)))}),this}}}),d.baseinfo_queryInstitutions=$.extend(!0,{},d.stationInfo_institutions,{extObj:{getNavData:function(){return n.getSites()},render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"company_name",title:"单位名称",width:150},{data:"company_address",title:"单位地址",width:300},{data:"area_name",title:"管辖"},{data:"parent_area",title:"隶属",width:100},{data:"supervisor_name",title:"主管领导姓名",width:80},{data:"supervisor_phone",title:"主管领导电话",width:100},{data:"owner",title:"部门负责人",width:80},{data:"owner_phone",title:"部门负责人电话",width:100},{data:"longitude",title:"经度",width:80},{data:"latitude",title:"纬度",width:80},{data:"station_num",title:"所辖站点个数",width:80},{data:"area_level",title:"隶属层级",width:100},{data:"network_type",title:"联网方式",width:100},{data:"bandwidth",title:"网络带宽",width:100},{data:"ipaddr",title:"IP地址",width:100},{data:"computer_brand",title:"上位机品牌",width:100},{data:"computer_os",title:"上位机操作系统",width:100},{data:"computer_conf",title:"主机配置",width:100},{data:"browser_name",title:"浏览器名称",width:100},{data:"server_capacity",title:"服务器容量",width:100},{data:"server_type",title:"服务器型号",width:100},{data:"cloud_address",title:"云空间地址",width:100},{data:"backup_period",title:"数据备份周期",width:100},{data:"backup_type",title:"数据备份方式",width:100},{data:"supervisor_depname",title:"监控部门名称",width:100},{data:"monitor_name1",title:"监控部门负责人",width:100},{data:"monitor_phone1",title:"监控部门负责人电话",width:100},{data:"monitor_name2",title:"其他联系人",width:100},{data:"monitor_phone2",title:"其他联系人电话",width:100},{data:"monitor_name3",title:"其他联系人",width:100},{data:"monitor_phone3",title:"其他联系人电话",width:100},{data:"monitor_tel1",title:"监控部门固定电话1",width:100},{data:"monitor_tel2",title:"监控部门固定电话2",width:100},{data:"duty_status",title:"值守状态/班次",width:80},{data:"manage",title:"管理员",width:80},{data:"viewer",title:"观察员",width:80},{data:"remark",title:"备注",width:150}]},p)))}),this}}}),d.baseinfo_queryMonitorSeller=$.extend(!0,{},d.stationInfo_monitorSeller,{extObj:{render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"bms_company",title:"生产厂家",width:200},{data:"bms_device_addr",title:"厂家地址",width:200},{data:"bms_postcode",title:"邮编",width:200},{data:"bms_url",title:"支持网址",width:200},{data:"bms_tel",title:"支持固话",width:200},{data:"bms_phone",title:"手机",width:200},{data:"bms_service_phone",title:"服务商电话",width:200},{data:"bms_service_name",title:"服务商名称",width:200},{data:"bms_service_contact",title:"服务商联系人",width:200},{data:"bms_service_url",title:"服务商地址",width:300},{data:"bms_version",title:"软件版本号",width:150},{data:"bms_update_mark",title:"软件升级记录",width:170},{data:"bms_mark",title:"备注",width:300}]},p)))}),this}}}),d.baseinfo_queryUpsInfo=$.extend(!0,{},d.stationInfo_upsInfo,{extObj:{getNavData:function(){return n.getSites()},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),console.log(r),$.extend(e,{id:i}),t.getUpsInfosData(e)},render:function(){var t=this;return t.destoryPlugin(),$("#auto").width("100%"),console.log(d.stationInfo_upsInfo),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sid",title:"站号",width:80},{data:"site_name",title:"站名",width:250},{data:"ups_factory",title:"生产厂家",width:250},{data:"ups_type",title:"型号",width:100},{data:"ups_create_date",title:"生产日期",width:150},{data:"ups_install_date",title:"安装日期",width:150},{data:"ups_power",title:"功率/容量（V/A）",width:150},{data:"ups_power_in",title:"输入功率（V/A）",width:150},{data:"ups_power_out",title:"输出功率（V/A）",width:150},{data:"ups_battery_vol",title:"外接电池电压（V）",width:150},{data:"ups_battery_current",title:"外接电池电流（A）",width:150},{data:"ac_protect",title:"AC过流保护（V/A）",width:150},{data:"dc_protect",title:"DC过流保护（V/A）",width:150},{data:"on_net",title:"联网检测",width:150},{data:"alarm_content",title:"报警内容",width:150},{data:"discharge_protect",title:"放电保护值（%）",width:150},{data:"redundancy_num",title:"冗余数量(台)",width:150},{data:"floting_charge",title:"浮充电压（V）",width:150},{data:"ups_vdc",title:"电压范围(V)",width:150},{data:"ups_reserve_hour",title:"额定候备时间（W/H）",width:250},{data:"ups_charge_mode",title:"充电方式",width:100},{data:"ups_max_charge",title:"最大充电电流（A）",width:150},{data:"ups_max_discharge",title:"最大放电电流（A）",width:150},{data:"ups_period_days",title:"规定维护周期（天）",width:150},{data:"ups_discharge_time",title:"维护放电时长（分钟）",width:150},{data:"ups_discharge_capacity",title:"维护放电容量（%）",width:150},{data:"ups_maintain_date",title:"维护到期日",width:150},{data:"ups_vender_phone",title:"厂家联系电话",width:120},{data:"ups_service",title:"服务商名称",width:120},{data:"ups_vender",title:"联系人",width:120},{data:"ups_service_phone",title:"服务商电话",width:100},{data:"remark",title:"备注",width:150}]},p)))}),this}}}),d.option_groupOption=$.extend(!0,{},d.optionSetting_groupOption,{extObj:{getNavData:function(){return n.getSites()},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"curstation:change",function(t){e.ids=null;if(!$(e.el).length||!$(e.el).is(":visible"))return;var n=e.getNavData();typeof n=="undefined"||!n||!n.ids.length?(e.data=[],e.render()):e.fetchData()})},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),console.log(r),$.extend(e,{id:i}),t.getGroupOptionData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"GroBatNum",title:"每组电池数",width:100},{data:"CurRange",title:"组电流量程",width:100},{data:"KI",title:"组电流系数",width:100},{data:"ZeroCurADC",title:"组电流零位",width:100},{data:"DisChaLim_R",title:"组放电电流超上限_红",width:100},{data:"DisChaLim_O",title:"组放电电流将达上限_橙",width:100},{data:"DisChaLim_Y",title:"组放电电流偏高_黄",width:100},{data:"ChaLim_R",title:"组充电电流超上限_红",width:100},{data:"ChaLim_O",title:"组充电电流将达上限_橙",width:100},{data:"ChaLim_Y",title:"组充电电流偏高_黄",width:100},{data:"MaxTem_R",title:"组温度超上限_红",width:100},{data:"MaxTem_O",title:"组温度将达上限_橙",width:100},{data:"MaxTem_Y",title:"组温度偏高_黄",width:100},{data:"MinTem_R",title:"组温度超下限_红",width:100},{data:"MinTem_O",title:"组温度将达下限_橙",width:100},{data:"MinTem_Y",title:"组温度偏低_黄",width:100},{data:"ChaCriterion",title:"组充放电判据",width:100}]})))}),this}}}),d.option_stationOption=$.extend(!0,{},d.optionSetting_stationOption,{extObj:{getNavData:function(){return n.getSites()},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"curstation:change",function(t){e.ids=null;if(!$(e.el).length||!$(e.el).is(":visible"))return;var n=e.getNavData();typeof n=="undefined"||!n||!n.ids.length?(e.data=[],e.render()):e.fetchData()})},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),console.log(r),$.extend(e,{id:i}),t.getSationOptionsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#lock").hide(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:1},columns:[{data:"sn_key",title:"站MAC",width:100},{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"Groups",title:"站内组数",width:100},{data:"GroBats",title:"每组电池数",width:100},{data:"CurSensor",title:"电流传感安装状态",width:100},{data:"Time_MR",title:"内阻测量间隔",width:100},{data:"SampleInt",title:"采集间隔",width:100},{data:"MaxTem_R",title:"高温报警_红",width:100},{data:"MaxTem_O",title:"高温报警_橙",width:100},{data:"MaxTem_Y",title:"高温报警_黄",width:100},{data:"MinTem_R",title:"低温报警_红",width:100},{data:"MinTem_O",title:"低温报警_橙",width:100},{data:"MinTem_Y",title:"低温报警_黄",width:100},{data:"MaxHum_R",title:"高湿报警_红",width:100},{data:"MaxHum_O",title:"高湿报警_橙",width:100},{data:"MaxHum_Y",title:"高湿报警_黄",width:100},{data:"MinHum_R",title:"低湿报警_红",width:100},{data:"MinHum_O",title:"低湿报警_橙",width:100},{data:"MinHum_Y",title:"低湿报警_黄",width:100},{data:"CurRange",title:"站电流量程",width:100},{data:"KI",title:"站电流系数",width:100},{data:"ZeroCurADC",title:"站电流零位",width:100},{data:"DisChaLim_R",title:"放电报警_红",width:100},{data:"DisChaLim_O",title:"放电报警_橙",width:100},{data:"DisChaLim_Y",title:"放电报警_黄",width:100},{data:"ChaLim_R",title:"充电报警_红",width:100},{data:"ChaLim_O",title:"充电报警_橙",width:100},{data:"ChaLim_Y",title:"充电报警_黄",width:100},{data:"HiVolLim_R",title:"高压报警_红",width:100},{data:"HiVolLim_O",title:"高压报警_橙",width:100},{data:"HiVolLim_Y",title:"高压报警_黄",width:100},{data:"LoVolLim_R",title:"低压报警_红",width:100},{data:"LoVolLim_O",title:"低压报警_橙",width:100},{data:"LoVolLim_Y",title:"低压报警_黄",width:100},{data:"ChaCriterion",title:"站充放电判据",width:100}]})))}),this}}}),d.option_batteryOption=$.extend(!0,{},d.optionSetting_batteryOption,{extObj:{getNavData:function(){return n.getSites()},extEvent:function(){var e=this;e.listenTo(Backbone.Events,"curstation:change",function(t){e.ids=null;if(!$(e.el).length||!$(e.el).is(":visible"))return;var n=e.getNavData();typeof n=="undefined"||!n||!n.ids.length?(e.data=[],e.render()):e.fetchData()})},fetchData:function(e){var e={},r=n.getSites(),i;this.ids&&this.ids.sid?i=this.ids.sid:i=r.ids.join(","),console.log(r),$.extend(e,{id:i}),t.getBatteryOptionsData(e)},render:function(){var t=this;return this.destoryPlugin(),$("#auto").width("100%"),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{},p,{data:t.data,scrollX:s.getListHeight(),scrollY:s.getListHeight(),fixedColumns:{leftColumns:2},columns:[{data:"site_name",title:"站名称",width:100},{data:"sid",title:"站号",width:100},{data:"KV",title:"电压系数",width:100},{data:"KT",title:"温度系数",width:100},{data:"KI",title:"激励电流系数",width:100},{data:"T0",title:"T0校准温度",width:100},{data:"ADC_T0",title:"T0温度码",width:100},{data:"T1",title:"T1校准温度",width:100},{data:"ADC_T1",title:"T1温度码",width:100},{data:"MaxU_R",title:"电池电压超上限_红",width:100},{data:"MaxU_O",title:"电池电压将达上限_橙",width:100},{data:"MaxU_Y",title:"电池电压偏高_黄",width:100},{data:"MinU_R",title:"电池电压超下限_红",width:100},{data:"MinU_O",title:"电池电压将达下限_橙",width:100},{data:"MinU_Y",title:"电池电压偏低_黄",width:100},{data:"MaxT_R",title:"电池温度超上限_红",width:100},{data:"MaxT_O",title:"电池温度将达上限_橙",width:100},{data:"MaxT_Y",title:"电池温度偏高_黄",width:100},{data:"MinT_R",title:"电池温度超下限_红",width:100},{data:"MinT_O",title:"电池温度将达下限_橙",width:100},{data:"MinT_Y",title:"电池温度偏低_黄",width:100},{data:"MaxR_R",title:"电池内阻超上限_红",width:100},{data:"MaxR_O",title:"电池内阻将达上限_橙",width:100},{data:"MaxR_Y",title:"电池内阻偏高_黄",width:100},{data:"MaxDevU_R",title:"电池电压偏差_红",width:100},{data:"MaxDevU_O",title:"电池电压偏差_橙",width:100},{data:"MaxDevU_Y",title:"电池电压偏差_黄",width:100},{data:"MaxDevT_R",title:"电池温度偏差_红",width:100},{data:"MaxDevT_O",title:"电池温度偏差_橙",width:100},{data:"MaxDevT_Y",title:"电池温度偏差_黄",width:100},{data:"MaxDevR_R",title:"电池内阻偏差_红",width:100},{data:"MaxDevR_O",title:"电池内阻偏差_橙",width:100},{data:"MaxDevR_Y",title:"电池内阻偏差_黄",width:100}]})))}),this}}}),d.equipment=$.extend(!0,{},d.equipmentSetting,{extObj:{render:function(){var t=this;t.destoryPlugin(),e(["fixedColumn"],function(){t.listPlugin.push($("#auto table").DataTable($.extend(!0,{data:t.data,language:{emptyTable:"站点数据为空"},scrollX:s.getListHeight(),scrollY:s.getListHeight(),columns:[{data:"sid",title:"站号",width:100},{data:"Device_name",title:"名称",width:100},{data:"Device_fun",title:"功能",width:100},{data:"Device_Factory_Name",title:"生产厂家",width:100},{data:"Device_Factory_Address",title:"厂家地址",width:200},{data:"Device_Factory_PostCode",title:"厂家邮编",width:100},{data:"Device_Factory_website",title:"技术支持网址",width:150},{data:"Device_Factory_Technology_cable_phone",title:"技术支持固话",width:100},{data:"Device_Factory_Technology_cellphone",title:"技术支持手机"}]},p)))})}}}),$(window).resize(function(){u&&u.listPlugin&&u.fetchData()}),{init:function(e,t,n,i){c=e,f=t,l=n,v(t,n,i),r.init();var s="",o="";return $.each([{data:"battery_sn_key",title:"电池序列号",width:100},{data:"sid",title:"站号",width:50},{data:"gid",title:"组号",width:50},{data:"bid",title:"电池号",width:50},{data:"CurrentAdjust_KV",title:"电压测量修正系数KV",width:200},{data:"TemperatureAdjust_KT",title:"温度测量修正系数KI",width:200},{data:"T0_ADC",title:"T0校准点ADC码",width:200},{data:"T0_Temperature",title:"T0校准点温度值（℃）",width:200},{data:"T1_ADC",title:"T1校准点ADC码",width:200},{data:"T1_Temperature",title:"T1校准点温度值（℃）",width:200},{data:"Rin_Span",title:"内阻测量量程",width:200},{data:"OSC",title:"OSC_Voltage",width:200},{data:"BatteryU_H",title:"电池电压高压限（V）",width:200},{data:"BaterryU_L",title:"电池电压低压限（V）",width:200},{data:"Electrode_T_H_Limit",title:"电极温度高温限（℃）",width:200},{data:"Electrode_T_L_Limit",title:"电极温度低温限（℃）",width:200},{data:"Rin_High_Limit",title:"电池内阻高限（mΩ）",width:200},{data:"Rin_Adjust_KR",title:"内阻测量修正系数KR",width:200},{data:"PreAmp_KA",title:"前置放大器修正系数KA",width:200},{data:"Rin_ExciteI_KI",title:"内阻测量激励电流修正系数KI",width:200}],function(e,t){o+=_.template('<label class="item-title" for="name"><%= title %>: </label> <input class="input-w-1" type="text" key="<%=data%>"/>')(t),e%2&&(s+='<div class="rowElem">'+o+"</div>",o="")}),o&&(s+='<div class="rowElem">'+o+"</div>"),this},isOver:function(e){if(typeof e=="undefined")return!!h;h=!!e},destory:function(){return u&&(u.destroy(),u=null,$("#list").html("")),this}}});